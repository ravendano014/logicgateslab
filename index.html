<!DOCTYPE html>
<html>
<head>
    <title>Shapes con Conectores en Canvas</title>
    <style>
    body {
                user-select: none;
                margin: 0;
                padding: 0;
            }

            .sidebar {
                width: 130px;
                height: 100%;
                background-color: #f0f0f0;
                position: absolute;
                top: 0;
                left: 0;
                overflow-y: scroll;
                padding: 10px;
            }

            .shape-item {
                cursor: pointer;
                margin-bottom: 10px;
                padding: 5px;
                border: 1px solid #ccc;
                background-color: #fff;
            }

            .canvas-container {
                margin-left: 160px; /* Espacio para la barra lateral */
            }

            /* Oculta inicialmente el contenido del grupo */
            .shape-group-content {
                display: none;
            }

            /* Estilo del botón que despliega/oculta el contenido */
            .shape-group-toggle {
                background-color: #ccc;
                border: none;
                padding: 5px 10px;
                cursor: pointer;
            }

            /* Estilo cuando el grupo está abierto */
            .shape-group.open .shape-group-content {
                display: block;
            }

            /* Cambia el aspecto del botón cuando el grupo está abierto */
            .shape-group.open .shape-group-toggle {
                background-color: #aaa;
            }
                    /* Estilo del botón que despliega/oculta el contenido */
            .sidebar-divider {
                background-color: teal;
                color: #e5e4e2;
                border: 2;
                text-align: center; /* Centra el texto horizontalmente */
                margin-top: 5px; /* Ajusta el margen superior según tus necesidades */
                font-weight: bold; /* Otras propiedades de estilo, si es necesario */
                margin-bottom: 5px;
            }

    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-divider">
            File
        </div>
            <div class="shape-item" onclick="createNewCircuit()">New Diagram</div>
            <div>
                <input type="file" id="loadFile" accept=".json" style="display: none;">
                <button id="loadButton">Load Logic Gates</button>
            </div>
            <div>
                <input type="text" id="fileName" value="logic_gates" placeholder="File Name">
                <button class="shape-group-toggle" Id="saveButton">Save Logic Gates</button>
            </div>
        <div class="sidebar-divider">
            Samples
        </div>
        <div class="shape-group">
            <button class="shape-group-toggle" onclick="toggleShapeGroup(this);">Load Samples</button>
            <div class="shape-group-content">
                <button id="loadSample1">BCD to 7 Segment Decoder</button>
                <button id="loadSample2">JK Flip Flop</button>
                <button id="loadSample3">D Latch</button>
                <button id="loadSample4">One bit Memory</button>
            </div>
        </div>
        <div class="sidebar-divider">
           Toolbar
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="Text">
            <svg id="Text" height="30" width="100" viewBox="0 0 50 20" xmlns="http://www.w3.org/2000/svg">
                <text x="0" y="15" fill="#000" font-weight="bold">Aa</text>
              </svg>
        </div>
        <div class="shape-item" onclick="buildComponent()">Build Component</div>
        <div class="shape-item">
            <label for="zoomSlider">Zoom:</label>
            <input type="range" id="zoomSlider" min="10" max="200" step="10" value="100" oninput="zoomCanvas()">
            <span id="zoomValue">100%</span>
        </div>
        <div class="shape-item" onclick="generateTruthTable()">Generate Truth Table</div>
        <div class="sidebar-divider">
            Input Controls
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="InputL">
            <svg id="InputL" xmlns="http://www.w3.org/2000/svg" width="50" height="50">
                <circle cx="23" cy="25" r="20" stroke="#000" stroke-width="4" fill="white" />
                <line x1="23" y1="0" x2="23" y2="25" stroke="#000" stroke-width="5" />
            </svg>
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="Clock">
                <svg id="Clock" xmlns="http://www.w3.org/2000/svg" width="50" height="50">
                    <circle cx="23" cy="25" r="20" stroke="#000" stroke-width="4" fill="white" />
                    <line x1="23" y1="10" x2="23" y2="25" stroke="#000" stroke-width="5" />
                    <line x1="23" y1="25" x2="35" y2="25" stroke="#000" stroke-width="5" />
                </svg>
        </div>
        <div class="sidebar-divider">
            Output Controls
        </div>
        <div class="shape-group">
            <button class="shape-group-toggle" onclick="toggleShapeGroup(this);">OutPut Controls</button>
            <div class="shape-group-content">
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="OutPutL">
                    <svg id="OutPutL" xmlns="http://www.w3.org/2000/svg" width="50" height="50">
                        <circle cx="23" cy="25" r="20" stroke="#000" stroke-width="4" fill="none" />
                    </svg>
                </div>
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="Display">
                    <svg xmlns="http://www.w3.org/2000/svg" width="96" height="160" viewBox="-1 -1 12 20" stroke="#FFF" stroke-width=".25">
                        <polygon id="a" fill="#F00" points="1, 1  2, 0  8, 0  9, 1  8, 2  2, 2"/>
                        <polygon id="b" fill="#F00" points="9, 1 10, 2 10, 8  9, 9  8, 8  8, 2"/>
                        <polygon id="c" fill="#F00" points="9, 9 10,10 10,16  9,17  8,16  8,10"/>
                        <polygon id="d" fill="#F00" points="9,17  8,18  2,18  1,17  2,16  8,16"/>
                        <polygon id="e" fill="#F00" points="1,17  0,16  0,10  1, 9  2,10  2,16"/>
                        <polygon id="f" fill="#F00" points="1, 9  0, 8  0, 2  1, 1  2, 2  2, 8"/>
                        <polygon id="g" fill="#F00" points="1, 9  2, 8  8, 8  9, 9  8,10  2,10"/>
                    </svg>
                </div>
            </div>
        </div>
        <div class="sidebar-divider">
            Logic Gates
        </div>
        <div class="shape-group">
            <button class="shape-group-toggle" onclick="toggleShapeGroup(this);">Type AND Logic Gates</button>
            <div class="shape-group-content">
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="AND">
                    <svg id="AND" xmlns="http://www.w3.org/2000/svg" width="100" height="50" >
                        <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M31 15H5M32 35H5"/>
                        <path d="M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30zm2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z" />
                    </svg>
                </div>
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="AND3">
                    <svg id="AND3" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                        <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M31 15H5M32 35H5"/>
                        <path d="M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30zm2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z" />
                        <line x1="5" y1="25" x2="30" y2="25" stroke="#000" stroke-width="2" />
                    </svg>
                </div>
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="AND4">
                <svg id="AND4" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                    <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M31 15H5M32 35H5"/>
                    <path d="M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30zm2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z" />
                    <line x1="5" y1="22" x2="30" y2="22" stroke="#000" stroke-width="2" />
                    <line x1="5" y1="28" x2="30" y2="28" stroke="#000" stroke-width="2" />
                </svg>
                </div>
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="AND5">
                    <svg id="AND5" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                        <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M31 15H5M32 35H5"/>
                        <path d="M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30zm2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z" />
                        <line x1="5" y1="20" x2="30" y2="20" stroke="#000" stroke-width="2" />
                        <line x1="5" y1="25" x2="30" y2="25" stroke="#000" stroke-width="2" />
                        <line x1="5" y1="30" x2="30" y2="30" stroke="#000" stroke-width="2" />
                    </svg>
                </div>
            </div>
        </div>
        <div class="shape-group">
            <button class="shape-group-toggle" onclick="toggleShapeGroup(this);">Type OR Logic Gates</button>
            <div class="shape-group-content">
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="OR">
                    <svg id="OR" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                        <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M31 15H5M32 35H5"/>
                        <path fill-rule="evenodd" d="M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z"/>
                    </svg>
                </div>
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="OR3">
                    <svg id="OR3" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                        <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M31 15H5M32 35H5"/>
                        <path fill-rule="evenodd" d="M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z"/>
                        <!-- Agregamos la línea en el centro -->
                        <line x1="5" y1="25" x2="30" y2="25" stroke="#000" stroke-width="2" />
                    </svg>
                </div>
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="OR4">
                    <svg id="OR4" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                        <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M31 15H5M32 35H5"/>
                        <path fill-rule="evenodd" d="M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z"/>
                        <line x1="5" y1="22" x2="30" y2="22" stroke="#000" stroke-width="2" />
                        <line x1="5" y1="28" x2="30" y2="28" stroke="#000" stroke-width="2" />
                    </svg>
                </div>
                <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="OR5">
                    <svg id="OR5" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                        <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M31 15H5M32 35H5"/>
                        <path fill-rule="evenodd" d="M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z"/>
                        <line x1="5" y1="20" x2="30" y2="20" stroke="#000" stroke-width="2" />
                        <line x1="5" y1="25" x2="30" y2="25" stroke="#000" stroke-width="2" />
                        <line x1="5" y1="30" x2="30" y2="30" stroke="#000" stroke-width="2" />
                    </svg>
                </div>
            </div>
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="NOT">
            <svg id="NOT" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                <path fill="none" stroke="#000" stroke-width="2" d="M79.15691 25H95M29.043478 25h-24"/>
                <path d="M28.96875 2.59375v44.8125l2.15625-1.0625 41.03125-20v-2.6875l-41.03125-20-2.15625-1.0625zm3 4.8125L68.09375 25l-36.125 17.59375V7.40625z" style="marker:none"/>
                <path fill="none" stroke="#000" stroke-width="3" d="M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z"  style="marker:none"/>
              </svg>
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="NAND">
            <svg id="NAND" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                <path fill="none" stroke="#000" stroke-width="2" d="M79 25h16M31 15H5M32 35H5"/>
                <path d="M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30zm2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z"/>
                <path fill="none" stroke="#000" stroke-width="3" d="M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z" />
              </svg>
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="NAND3">
            <svg id="NAND3" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                <path fill="none" stroke="#000" stroke-width="2" d="M79 25h16M31 15H5M32 35H5"/>
                <path d="M30 5V45H50.47619c11.267908 0 20-9.000045 20-20s-8.732091-20-20-20H30zm2.857143 2.857143H50.47619c9.760663 0 16.666667 7.639955 16.666667 17.142857 0 9.502902-7.382195 17.142857-17.142857 17.142857H32.857143V7.857143z"/>
                <path fill="none" stroke="#000" stroke-width="3" d="M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z" />
                <line x1="5" y1="25" x2="30" y2="25" stroke="#000" stroke-width="2" />
              </svg>
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="NOR">
            <svg id="NOR" xmlns="http://www.w3.org/2000/svg" width="100" height="50" >
                <path fill="none" stroke="#000" stroke-width="2" d="M79 25h16M31 15H5M32 35H5"/>
                <path fill-rule="evenodd" d="M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z"/>
                <path fill="none" stroke="#000" stroke-width="3" d="M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z" style="marker:none"/>
              </svg>        
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="NOR3">
            <svg id="NOR3" xmlns="http://www.w3.org/2000/svg" width="100" height="50" >
                <path fill="none" stroke="#000" stroke-width="2" d="M79 25h16M31 15H5M32 35H5"/>
                <path fill-rule="evenodd" d="M24.09375 5l2 2.4375S31.75 14.437549 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.408076.000001 7.689699.024514 13.625-2.40625s12.536536-7.343266 17.6875-16.875L71.25 25l1.3125-.71875C62.259387 5.21559 46.006574 5 41.25 5H24.09375zm5.875 3H41.25c4.684173 0 18.28685-.130207 27.96875 17C64.451964 33.429075 58.697469 37.68391 53.5 39.8125 48.139339 42.007924 43.658075 42.000001 41.25 42H30c1.873588-3.108434 4.75-9.04935 4.75-17 0-7.973354-2.908531-13.900185-4.78125-17z"/>
                <path fill="none" stroke="#000" stroke-width="3" d="M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z" style="marker:none"/>
                <line x1="5" y1="25" x2="30" y2="25" stroke="#000" stroke-width="2" />
              </svg>        
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="XOR">
            <svg id="XOR" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M30.38572 15H5M31.3621 35H5"/>
                <g fill-rule="evenodd">
                  <path d="M24.25 42C22.65263 44.6444 22 45 22 45h-3.65625l2-2.4375S26 35.56245 26 25 20.34375 7.4375 20.34375 7.4375l-2-2.4375H22c.78125.9375 1.42188 1.65625 2.21875 3C26.09147 11.09981 29 17.02665 29 25c0 7.95065-2.8967 13.87942-4.75 17z"/>
                  <path d="M24.09375 5l2 2.4375S31.75 14.43755 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.40808 0 7.6897.02451 13.625-2.40625s12.53654-7.34327 17.6875-16.875L71.25 25l1.3125-.71875C62.25939 5.21559 46.00657 5 41.25 5H24.09375zm5.875 3H41.25c4.68417 0 18.28685-.1302 27.96875 17C64.45196 33.42907 58.69747 37.68391 53.5 39.8125 48.13934 42.00792 43.65808 42 41.25 42H30c1.87359-3.10843 4.75-9.04935 4.75-17 0-7.97335-2.90853-13.90019-4.78125-17z"/>
                </g>
            </svg>        
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="XNOR">
            <svg id="XNOR" xmlns="http://www.w3.org/2000/svg" width="100" height="50">
                <path fill="none" stroke="#000" stroke-width="2" d="M70 25h25M30.38572 15H5M31.3621 35H5"/>
                <g fill-rule="evenodd">
                    <path d="M24.25 42C22.65263 44.6444 22 45 22 45h-3.65625l2-2.4375S26 35.56245 26 25 20.34375 7.4375 20.34375 7.4375l-2-2.4375H22c.78125.9375 1.42188 1.65625 2.21875 3C26.09147 11.09981 29 17.02665 29 25c0 7.95065-2.8967 13.87942-4.75 17z"/>
                    <path d="M24.09375 5l2 2.4375S31.75 14.43755 31.75 25s-5.65625 17.5625-5.65625 17.5625l-2 2.4375H41.25c2.40808 0 7.6897.02451 13.625-2.40625s12.53654-7.34327 17.6875-16.875L71.25 25l1.3125-.71875C62.25939 5.21559 46.00657 5 41.25 5H24.09375zm5.875 3H41.25c4.68417 0 18.28685-.1302 27.96875 17C64.45196 33.42907 58.69747 37.68391 53.5 39.8125 48.13934 42.00792 43.65808 42 41.25 42H30c1.87359-3.10843 4.75-9.04935 4.75-17 0-7.97335-2.90853-13.90019-4.78125-17z"/>
                    <path fill="none" stroke="#000" stroke-width="3" d="M79 25a4 4 0 1 1-8 0 4 4 0 1 1 8 0z" style="marker:none"/>
                </g>
            </svg>      
        </div>
        <div class="sidebar-divider">
            Flip Flops
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="D_Flip_Flop">
            <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="100"
   height="100"
   id="D_Flip_Flop"
   sodipodi:version="0.32"
   inkscape:version="0.46"
   version="1.0"
   sodipodi:docbase="C:\Program Files\Inkscape"
   sodipodi:docname="D Flip-flop Symbol.svg"
   inkscape:output_extension="org.inkscape.output.svg.inkscape">
  <defs
     id="defs4">
    <inkscape:perspective
       sodipodi:type="inkscape:persp3d"
       inkscape:vp_x="0 : 50 : 1"
       inkscape:vp_y="0 : 1000 : 0"
       inkscape:vp_z="100 : 50 : 1"
       inkscape:persp3d-origin="50 : 33.333333 : 1"
       id="perspective3848" />
  </defs>
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="2"
     inkscape:cx="26.836729"
     inkscape:cy="36.81932"
     inkscape:document-units="px"
     inkscape:current-layer="layer1"
     showgrid="true"
     inkscape:grid-bbox="true"
     inkscape:grid-points="true"
     showguides="true"
     inkscape:guide-bbox="true"
     gridtolerance="5px"
     inkscape:window-width="1024"
     inkscape:window-height="712"
     inkscape:window-x="129"
     inkscape:window-y="116"
     inkscape:snap-bbox="true"
     objecttolerance="11">
    <inkscape:grid
       id="GridFromPre046Settings"
       type="xygrid"
       originx="0px"
       originy="0px"
       spacingx="5px"
       spacingy="5px"
       color="#0000ff"
       empcolor="#0000ff"
       opacity="0.2"
       empopacity="0.4"
       empspacing="5"
       visible="true"
       enabled="true" />
  </sodipodi:namedview>
  <metadata
     id="metadata7">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1">
    <g
       id="g4867"
       style="fill:none">
      <rect
         y="11.500001"
         x="21.499998"
         height="77"
         width="56.999996"
         id="rect1311"
         style="opacity:1;fill:none;fill-opacity:0.03703703;stroke:#000000;stroke-width:2.99999952;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
      <path
         id="path3085"
         d="M 21,30 L 5,30"
         style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         sodipodi:nodetypes="cc" />
      <path
         id="path3087"
         d="M 21,70 L 5,70"
         style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         sodipodi:nodetypes="cc" />
      <path
         id="path3089"
         d="M 79,70 L 95,70"
         style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         sodipodi:nodetypes="cc" />
      <path
         id="path3091"
         d="M 79,30 L 95,30"
         style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
         sodipodi:nodetypes="cc" />
    </g>
    <path
       sodipodi:nodetypes="cc"
       style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
       d="M 63.806565,62 L 73.306565,62"
       id="path3081" />
    <text
       xml:space="preserve"
       style="font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
       x="35.890625"
       y="34.773438"
       id="text3850"
       sodipodi:linespacing="100%"><tspan
         sodipodi:role="line"
         id="tspan3852"
         x="35.890625"
         y="34.773438">D</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:14;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
       x="73.907623"
       y="35"
       id="text3858"
       sodipodi:linespacing="100%"><tspan
         sodipodi:role="line"
         id="tspan3860"
         x="73.907623"
         y="35">Q</tspan></text>
    <text
       xml:space="preserve"
       style="font-size:14;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
       x="73.825577"
       y="75"
       id="text3863"
       sodipodi:linespacing="100%"><tspan
         sodipodi:role="line"
         id="tspan3865"
         x="73.825577"
         y="75">Q</tspan></text>
    <path
       style="opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       d="M 21.0625,65 L 32.5625,70 L 21.0625,75"
       id="path3888"
       sodipodi:nodetypes="ccc" />
  </g>
</svg>

        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="T_Flip_Flop">
            <?xml version="1.0" encoding="UTF-8" standalone="no"?>
            <!-- Created with Inkscape (http://www.inkscape.org/) -->
            <svg
               xmlns:dc="http://purl.org/dc/elements/1.1/"
               xmlns:cc="http://creativecommons.org/ns#"
               xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
               xmlns:svg="http://www.w3.org/2000/svg"
               xmlns="http://www.w3.org/2000/svg"
               xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
               xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
               width="100"
               height="100"
               id="T_Flip_Flop"
               sodipodi:version="0.32"
               inkscape:version="0.46"
               version="1.0"
               sodipodi:docbase="C:\Program Files\Inkscape"
               sodipodi:docname="T Flip-flop Symbol.svg"
               inkscape:output_extension="org.inkscape.output.svg.inkscape">
              <defs
                 id="defs4">
                <inkscape:perspective
                   sodipodi:type="inkscape:persp3d"
                   inkscape:vp_x="0 : 50 : 1"
                   inkscape:vp_y="0 : 1000 : 0"
                   inkscape:vp_z="100 : 50 : 1"
                   inkscape:persp3d-origin="50 : 33.333333 : 1"
                   id="perspective3848" />
              </defs>
              <sodipodi:namedview
                 id="base"
                 pagecolor="#ffffff"
                 bordercolor="#666666"
                 borderopacity="1.0"
                 inkscape:pageopacity="0.0"
                 inkscape:pageshadow="2"
                 inkscape:zoom="2"
                 inkscape:cx="26.836729"
                 inkscape:cy="36.81932"
                 inkscape:document-units="px"
                 inkscape:current-layer="layer1"
                 showgrid="true"
                 inkscape:grid-bbox="true"
                 inkscape:grid-points="true"
                 showguides="true"
                 inkscape:guide-bbox="true"
                 gridtolerance="5px"
                 inkscape:window-width="1024"
                 inkscape:window-height="712"
                 inkscape:window-x="129"
                 inkscape:window-y="116"
                 inkscape:snap-bbox="true"
                 objecttolerance="11">
                <inkscape:grid
                   id="GridFromPre046Settings"
                   type="xygrid"
                   originx="0px"
                   originy="0px"
                   spacingx="5px"
                   spacingy="5px"
                   color="#0000ff"
                   empcolor="#0000ff"
                   opacity="0.2"
                   empopacity="0.4"
                   empspacing="5"
                   visible="true"
                   enabled="true" />
              </sodipodi:namedview>
              <metadata
                 id="metadata7">
                <rdf:RDF>
                  <cc:Work
                     rdf:about="">
                    <dc:format>image/svg+xml</dc:format>
                    <dc:type
                       rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                  </cc:Work>
                </rdf:RDF>
              </metadata>
              <g
                 inkscape:label="Layer 1"
                 inkscape:groupmode="layer"
                 id="layer1">
                <g
                   id="g4867"
                   style="fill:none">
                  <rect
                     y="11.500001"
                     x="21.499998"
                     height="77"
                     width="56.999996"
                     id="rect1311"
                     style="opacity:1;fill:none;fill-opacity:0.03703703;stroke:#000000;stroke-width:2.99999952;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                  <path
                     id="path3085"
                     d="M 21,30 L 5,30"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                  <path
                     id="path3087"
                     d="M 21,70 L 5,70"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                  <path
                     id="path3089"
                     d="M 79,70 L 95,70"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                  <path
                     id="path3091"
                     d="M 79,30 L 95,30"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                </g>
                <path
                   sodipodi:nodetypes="cc"
                   style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                   d="M 63.806565,62 L 73.306565,62"
                   id="path3081" />
                <text
                   xml:space="preserve"
                   style="font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
                   x="35.890625"
                   y="34.773438"
                   id="text3850"
                   sodipodi:linespacing="100%"><tspan
                     sodipodi:role="line"
                     id="tspan3852"
                     x="35.890625"
                     y="34.773438">T</tspan></text>
                <text
                   xml:space="preserve"
                   style="font-size:14;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
                   x="73.907623"
                   y="35"
                   id="text3858"
                   sodipodi:linespacing="100%"><tspan
                     sodipodi:role="line"
                     id="tspan3860"
                     x="73.907623"
                     y="35">Q</tspan></text>
                <text
                   xml:space="preserve"
                   style="font-size:14;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
                   x="73.825577"
                   y="75"
                   id="text3863"
                   sodipodi:linespacing="100%"><tspan
                     sodipodi:role="line"
                     id="tspan3865"
                     x="73.825577"
                     y="75">Q</tspan></text>
                <path
                   style="opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                   d="M 21.0625,65 L 32.5625,70 L 21.0625,75"
                   id="path3888"
                   sodipodi:nodetypes="ccc" />
              </g>
            </svg>
                       
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="JK_Flip_Flop">
            <?xml version="1.0" encoding="UTF-8" standalone="no"?>
            <!-- Created with Inkscape (http://www.inkscape.org/) -->
            <svg
               xmlns:dc="http://purl.org/dc/elements/1.1/"
               xmlns:cc="http://creativecommons.org/ns#"
               xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
               xmlns:svg="http://www.w3.org/2000/svg"
               xmlns="http://www.w3.org/2000/svg"
               xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
               xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
               width="100"
               height="100"
               id="JK_Flip_Flop"
               sodipodi:version="0.32"
               inkscape:version="0.46"
               version="1.0"
               sodipodi:docbase="C:\Program Files\Inkscape"
               sodipodi:docname="JK Flip-flop Symbol.svg"
               inkscape:output_extension="org.inkscape.output.svg.inkscape">
              <defs
                 id="defs4">
                <inkscape:perspective
                   sodipodi:type="inkscape:persp3d"
                   inkscape:vp_x="0 : 50 : 1"
                   inkscape:vp_y="0 : 1000 : 0"
                   inkscape:vp_z="100 : 50 : 1"
                   inkscape:persp3d-origin="50 : 33.333333 : 1"
                   id="perspective3848" />
              </defs>
              <sodipodi:namedview
                 id="base"
                 pagecolor="#ffffff"
                 bordercolor="#666666"
                 borderopacity="1.0"
                 inkscape:pageopacity="0.0"
                 inkscape:pageshadow="2"
                 inkscape:zoom="4"
                 inkscape:cx="35.223932"
                 inkscape:cy="50.283722"
                 inkscape:document-units="px"
                 inkscape:current-layer="layer1"
                 showgrid="true"
                 inkscape:grid-bbox="true"
                 inkscape:grid-points="true"
                 showguides="true"
                 inkscape:guide-bbox="true"
                 gridtolerance="5px"
                 inkscape:window-width="1024"
                 inkscape:window-height="712"
                 inkscape:window-x="94"
                 inkscape:window-y="107"
                 inkscape:snap-bbox="true"
                 objecttolerance="11">
                <inkscape:grid
                   id="GridFromPre046Settings"
                   type="xygrid"
                   originx="0px"
                   originy="0px"
                   spacingx="5px"
                   spacingy="5px"
                   color="#0000ff"
                   empcolor="#0000ff"
                   opacity="0.2"
                   empopacity="0.4"
                   empspacing="5"
                   visible="true"
                   enabled="true" />
              </sodipodi:namedview>
              <metadata
                 id="metadata7">
                <rdf:RDF>
                  <cc:Work
                     rdf:about="">
                    <dc:format>image/svg+xml</dc:format>
                    <dc:type
                       rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                  </cc:Work>
                </rdf:RDF>
              </metadata>
              <g
                 inkscape:label="Layer 1"
                 inkscape:groupmode="layer"
                 id="layer1">
                <g
                   id="g4867"
                   style="fill:none">
                  <rect
                     y="11.500001"
                     x="21.499998"
                     height="77"
                     width="56.999996"
                     id="rect1311"
                     style="opacity:1;fill:none;fill-opacity:0.03703703;stroke:#000000;stroke-width:2.99999952;stroke-linecap:square;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1" />
                  <path
                     id="path3085"
                     d="M 21,30 L 5,30"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                  <path
                     id="path3087"
                     d="M 21,70 L 5,70"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                  <path
                     id="path3089"
                     d="M 79,70 L 95,70"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                  <path
                     id="path3091"
                     d="M 79,30 L 95,30"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                  <path
                     id="path4659"
                     d="M 21,50 L 5,50"
                     style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                     sodipodi:nodetypes="cc" />
                </g>
                <path
                   sodipodi:nodetypes="cc"
                   style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                   d="M 63.806565,62 L 73.306565,62"
                   id="path3081" />
                <text
                   xml:space="preserve"
                   style="font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
                   x="33.890625"
                   y="34.773438"
                   id="text3850"
                   sodipodi:linespacing="100%"><tspan
                     sodipodi:role="line"
                     id="tspan3852"
                     x="33.890625"
                     y="34.773438">J</tspan></text>
                <text
                   xml:space="preserve"
                   style="font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
                   x="73.907623"
                   y="35"
                   id="text3858"
                   sodipodi:linespacing="100%"><tspan
                     sodipodi:role="line"
                     id="tspan3860"
                     x="73.907623"
                     y="35">Q</tspan></text>
                <text
                   xml:space="preserve"
                   style="font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
                   x="73.825577"
                   y="75"
                   id="text3863"
                   sodipodi:linespacing="100%"><tspan
                     sodipodi:role="line"
                     id="tspan3865"
                     x="73.825577"
                     y="75">Q</tspan></text>
                <path
                   style="opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
                   d="M 21.0625,45 L 32.5625,50 L 21.0625,55"
                   id="path3888"
                   sodipodi:nodetypes="ccc" />
                <text
                   sodipodi:linespacing="100%"
                   id="text4661"
                   y="75"
                   x="35.702469"
                   style="font-size:14px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:end;line-height:100%;writing-mode:lr-tb;text-anchor:end;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:DejaVu Sans;-inkscape-font-specification:DejaVu Sans"
                   xml:space="preserve"><tspan
                     y="75"
                     x="35.702469"
                     id="tspan4663"
                     sodipodi:role="line">K</tspan></text>
              </g>
            </svg>
           
        </div>
        <div class="sidebar-divider">
            IC Components
        </div>
        <div class="shape-item" draggable="true" ondragstart="drag(event)" data-shape-type="Pin14">
            <svg
                xmlns:dc="http://purl.org/dc/elements/1.1/"
                xmlns:cc="http://web.resource.org/cc/"
                xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                xmlns:svg="http://www.w3.org/2000/svg"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:sodipodi="http://inkscape.sourceforge.net/DTD/sodipodi-0.dtd"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                width="200"
                height="200"
                id="Pin14"
                sodipodi:version="0.32"
                inkscape:version="0.43"
                version="1.0"
                sodipodi:docbase="C:\Documents and Settings\Julian\My Documents\My Pictures\Electronics\Vector Illustrations\ICs"
                sodipodi:docname="Pinout Template 14 Pin.svg">
                <defs
                    id="defs4" />
                <sodipodi:namedview
                    id="base"
                    pagecolor="#ffffff"
                    bordercolor="#666666"
                    borderopacity="1.0"
                    inkscape:pageopacity="0.0"
                    inkscape:pageshadow="2"
                    inkscape:zoom="2.725"
                    inkscape:cx="167.75892"
                    inkscape:cy="106.86861"
                    inkscape:document-units="px"
                    inkscape:current-layer="layer1"
                    showgrid="true"
                    inkscape:grid-bbox="true"
                    inkscape:grid-points="true"
                    gridspacingx="5px"
                    gridspacingy="5px"
                    gridtolerance="5px"
                    inkscape:window-width="1024"
                    inkscape:window-height="712"
                    inkscape:window-x="-4"
                    inkscape:window-y="-4" />
                <metadata
                    id="metadata7">
                    <rdf:RDF>
                    <cc:Work
                        rdf:about="">
                        <dc:format>image/svg+xml</dc:format>
                        <dc:type
                        rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
                    </cc:Work>
                    </rdf:RDF>
                </metadata>
                <g
                    inkscape:label="Layer 1"
                    inkscape:groupmode="layer"
                    id="layer1">
                    <path
                    style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:1.99999952;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1"
                    d="M 50.052067,10.028993 L 149.99995,10.028993 L 149.99995,189.99995 C 149.99995,189.99995 50.052067,189.99995 50.052067,189.99995 L 50.052067,10.028993 z "
                    id="path1349" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 40,19.92856 L 50,19.92856 L 50,29.92856 L 40,29.92856 L 40,19.92856 z "
                    id="rect2226" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 40,44.928558 L 50,44.928558 L 50,54.928558 L 40,54.928558 L 40,44.928558 z "
                    id="rect3101" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 40,69.928558 L 50,69.928558 L 50,79.928558 L 40,79.928558 L 40,69.928558 z "
                    id="rect3103" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 40,94.928558 L 50,94.928558 L 50,104.92856 L 40,104.92856 L 40,94.928558 z "
                    id="rect3105" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 40,119.92856 L 50,119.92856 L 50,129.92856 L 40,129.92856 L 40,119.92856 z "
                    id="rect3107" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 40,144.92856 L 50,144.92856 L 50,154.92856 L 40,154.92856 L 40,144.92856 z "
                    id="rect3109" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 40,169.92856 L 50,169.92856 L 50,179.92856 L 40,179.92856 L 40,169.92856 z "
                    id="rect3111" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 150,20 L 160,20 L 160,30 L 150,30 L 150,20 z "
                    id="rect3113" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 150,44.999998 L 160,44.999998 L 160,54.999998 L 150,54.999998 L 150,44.999998 z "
                    id="rect3115" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 150,69.999998 L 160,69.999998 L 160,79.999998 L 150,79.999998 L 150,69.999998 z "
                    id="rect3117" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 150,94.999998 L 160,94.999998 L 160,105 L 150,105 L 150,94.999998 z "
                    id="rect3119" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 150,120 L 160,120 L 160,130 L 150,130 L 150,120 z "
                    id="rect3121" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 150,145 L 160,145 L 160,155 L 150,155 L 150,145 z "
                    id="rect3123" />
                    <path
                    style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:1;stroke-miterlimit:4;stroke-dashoffset:0;stroke-opacity:1"
                    d="M 150,170 L 160,170 L 160,180 L 150,180 L 150,170 z "
                    id="rect3125" />
                    <path
                    style="font-size:7.20000029px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 46.243707,27.056925 L 43.410114,27.056925 L 43.410114,26.52255 L 44.499957,26.52255 L 44.499957,23.013956 L 43.410114,23.013956 L 43.410114,22.535831 C 43.557769,22.535835 43.715972,22.524117 43.884723,22.500675 C 44.053471,22.474898 44.181206,22.43857 44.267926,22.39169 C 44.375737,22.333101 44.460112,22.259273 44.521051,22.170206 C 44.58433,22.078805 44.620658,21.95693 44.630035,21.804581 L 45.174957,21.804581 L 45.174957,26.52255 L 46.243707,26.52255 L 46.243707,27.056925"
                    id="text4000" />
                    <path
                    style="font-size:7.20000029px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 46.598779,52.1726 L 43.055029,52.1726 L 43.055029,51.437834 C 43.301122,51.226898 43.547216,51.01596 43.793311,50.805022 C 44.041747,50.594086 44.272606,50.38432 44.485889,50.175725 C 44.935886,49.73979 45.244089,49.394087 45.410498,49.138615 C 45.576901,48.880806 45.660104,48.603072 45.660108,48.305412 C 45.660104,48.033541 45.56987,47.821432 45.389404,47.669084 C 45.211277,47.514401 44.961668,47.437057 44.640576,47.437053 C 44.427293,47.437057 44.196434,47.474557 43.947998,47.549553 C 43.699559,47.624557 43.456981,47.739401 43.220264,47.894084 L 43.185107,47.894084 L 43.185107,47.155803 C 43.351513,47.073777 43.572997,46.998777 43.849561,46.930803 C 44.128465,46.862839 44.397996,46.828855 44.658154,46.82885 C 45.19487,46.828855 45.615573,46.958933 45.920264,47.219084 C 46.224948,47.476901 46.377291,47.827291 46.377295,48.270256 C 46.377291,48.469478 46.35151,48.655806 46.299951,48.82924 C 46.250729,49.000337 46.176901,49.163228 46.078467,49.317912 C 45.987057,49.463227 45.879245,49.606196 45.755029,49.746818 C 45.633151,49.887446 45.484323,50.043305 45.308545,50.214397 C 45.057761,50.460492 44.798777,50.699554 44.531592,50.931584 C 44.264403,51.161273 44.014793,51.374554 43.782764,51.571428 L 46.598779,51.571428 L 46.598779,52.1726"
                    id="text4004" />
                    <path
                    style="font-size:7.20000029px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 46.1646,74.667361 C 46.277096,74.768145 46.369674,74.894707 46.442334,75.047049 C 46.514986,75.199395 46.551314,75.396269 46.551319,75.637674 C 46.551314,75.876738 46.507955,76.095878 46.42124,76.295096 C 46.334518,76.494315 46.212643,76.667753 46.055615,76.815408 C 45.879831,76.979471 45.672409,77.101346 45.43335,77.181033 C 45.196628,77.258377 44.936472,77.297049 44.652881,77.297049 C 44.362254,77.297049 44.076317,77.261893 43.795068,77.19158 C 43.513817,77.123612 43.282958,77.048612 43.10249,76.96658 L 43.10249,76.231815 L 43.155225,76.231815 C 43.354443,76.363065 43.588817,76.47205 43.85835,76.558768 C 44.127879,76.645487 44.388035,76.688846 44.638818,76.688846 C 44.786472,76.688846 44.943504,76.664237 45.109912,76.615018 C 45.276316,76.5658 45.411081,76.493143 45.514209,76.397049 C 45.622019,76.293925 45.701706,76.180253 45.753272,76.056033 C 45.807175,75.931816 45.834128,75.774785 45.834131,75.58494 C 45.834128,75.397441 45.803659,75.242754 45.742725,75.120877 C 45.684128,74.99666 45.602097,74.899395 45.496631,74.82908 C 45.391159,74.756426 45.263425,74.707208 45.113428,74.681424 C 44.963425,74.653301 44.801707,74.639239 44.628272,74.639236 L 44.311865,74.639236 L 44.311865,74.055643 L 44.557959,74.055643 C 44.914207,74.055646 45.1978,73.981818 45.40874,73.834158 C 45.622019,73.684162 45.728659,73.466193 45.728662,73.180252 C 45.728659,73.053694 45.701706,72.943537 45.647803,72.849783 C 45.593894,72.753694 45.518894,72.675178 45.422803,72.614236 C 45.322019,72.553303 45.214206,72.511116 45.099365,72.487674 C 44.984519,72.464241 44.854441,72.452522 44.709131,72.452518 C 44.486473,72.452522 44.249754,72.492366 43.998975,72.572049 C 43.748192,72.651741 43.511474,72.764241 43.288818,72.909549 L 43.253662,72.909549 L 43.253662,72.174783 C 43.420067,72.092757 43.641552,72.017757 43.918115,71.949783 C 44.19702,71.879476 44.466551,71.84432 44.726709,71.844314 C 44.982175,71.84432 45.207175,71.867757 45.401709,71.914627 C 45.596237,71.961507 45.772018,72.036507 45.929053,72.139627 C 46.097799,72.252132 46.225534,72.388069 46.312256,72.547439 C 46.398971,72.706819 46.44233,72.893147 46.442334,73.106424 C 46.44233,73.397053 46.339205,73.651349 46.132959,73.869314 C 45.929049,74.084943 45.687643,74.22088 45.40874,74.277127 L 45.40874,74.326346 C 45.521237,74.345099 45.650143,74.384942 45.795459,74.445877 C 45.940768,74.504473 46.063815,74.578301 46.1646,74.667361"
                    id="text4008" />
                    <path
                    style="font-size:7.20000029px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 46.806201,100.785 L 46.029248,100.785 L 46.029248,102.25805 L 45.354248,102.25805 L 45.354248,100.785 L 42.847607,100.785 L 42.847607,99.976408 L 45.382373,97.023283 L 46.029248,97.023283 L 46.029248,100.2225 L 46.806201,100.2225 L 46.806201,100.785 M 45.354248,100.2225 L 45.354248,97.860002 L 43.325732,100.2225 L 45.354248,100.2225"
                    id="text4012" />
                    <path
                    style="font-size:7.20000029px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 46.53198,125.61061 C 46.531975,125.85436 46.487444,126.08756 46.398386,126.31022 C 46.309319,126.53287 46.187445,126.72037 46.032761,126.87272 C 45.864007,127.03678 45.662445,127.16334 45.428073,127.2524 C 45.196039,127.33912 44.926508,127.38248 44.619479,127.38248 C 44.33354,127.38248 44.05815,127.35201 43.793308,127.29108 C 43.528463,127.23248 43.304635,127.161 43.121823,127.07662 L 43.121823,126.33483 L 43.171042,126.33483 C 43.363229,126.4567 43.588228,126.561 43.846042,126.64772 C 44.103853,126.73209 44.356978,126.77428 44.605417,126.77428 C 44.771821,126.77428 44.932368,126.75084 45.087058,126.70397 C 45.244086,126.65709 45.383539,126.57506 45.505417,126.45787 C 45.608539,126.35709 45.685883,126.23639 45.737448,126.09576 C 45.791351,125.95514 45.818304,125.79225 45.818308,125.60709 C 45.818304,125.42663 45.786664,125.27428 45.723386,125.15006 C 45.662445,125.02584 45.576898,124.92624 45.466745,124.85123 C 45.344867,124.76217 45.196039,124.70006 45.020261,124.6649 C 44.846821,124.62741 44.65229,124.60866 44.436667,124.60865 C 44.230415,124.60866 44.031197,124.62272 43.839011,124.65084 C 43.649166,124.67897 43.485103,124.70709 43.346823,124.73522 L 43.346823,122.03873 L 46.496823,122.03873 L 46.496823,122.65397 L 44.025339,122.65397 L 44.025339,124.04615 C 44.126118,124.03678 44.229243,124.02975 44.334714,124.02506 C 44.440181,124.02038 44.531587,124.01803 44.608933,124.01803 C 44.892524,124.01803 45.140961,124.04264 45.354245,124.09186 C 45.567523,124.13874 45.763226,124.22311 45.941355,124.34498 C 46.128851,124.47389 46.274163,124.6403 46.377292,124.8442 C 46.480413,125.04811 46.531975,125.30358 46.53198,125.61061"
                    id="text4016" />
                    <path
                    style="font-size:7.20000029px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 46.679648,150.69467 C 46.679644,151.2267 46.503863,151.66147 46.152304,151.99897 C 45.803082,152.33412 45.374176,152.5017 44.865585,152.5017 C 44.607771,152.5017 44.373396,152.46186 44.16246,152.38217 C 43.951521,152.30248 43.765193,152.18412 43.603476,152.02709 C 43.401913,151.83256 43.246053,151.57475 43.135898,151.25365 C 43.028085,150.93256 42.974179,150.54584 42.974179,150.0935 C 42.974179,149.62944 43.023397,149.21811 43.121835,148.85951 C 43.222616,148.50092 43.381991,148.18217 43.59996,147.90326 C 43.806209,147.63842 44.072224,147.43217 44.398007,147.28451 C 44.723786,147.13452 45.103473,147.05952 45.53707,147.05951 C 45.675348,147.05952 45.791363,147.06538 45.885117,147.07709 C 45.978863,147.08881 46.073785,147.10991 46.169882,147.14037 L 46.169882,147.81186 L 46.134726,147.81186 C 46.069098,147.7767 45.969488,147.74389 45.835898,147.71342 C 45.704645,147.68061 45.569879,147.6642 45.431601,147.6642 C 44.927692,147.6642 44.52574,147.82241 44.225742,148.13881 C 43.92574,148.45288 43.751131,148.87827 43.701914,149.41498 C 43.898787,149.29545 44.092146,149.20522 44.281992,149.14428 C 44.474177,149.081 44.695661,149.04936 44.946445,149.04936 C 45.169098,149.04936 45.364801,149.07045 45.533554,149.11264 C 45.704645,149.15248 45.879254,149.23452 46.057382,149.35873 C 46.263629,149.5017 46.418316,149.68217 46.521445,149.90014 C 46.626909,150.11811 46.679644,150.38295 46.679648,150.69467 M 45.965976,150.72279 C 45.965973,150.50483 45.93316,150.32436 45.867539,150.18139 C 45.804254,150.03842 45.698785,149.9142 45.551132,149.80873 C 45.443317,149.73373 45.323786,149.68451 45.192539,149.66107 C 45.061286,149.63764 44.924177,149.62592 44.78121,149.62592 C 44.58199,149.62592 44.396833,149.64936 44.225742,149.69623 C 44.054646,149.74311 43.878865,149.81576 43.698398,149.9142 C 43.693709,149.96576 43.690194,150.01616 43.687851,150.06537 C 43.685506,150.11225 43.684334,150.17201 43.684335,150.24467 C 43.684334,150.61498 43.721834,150.90795 43.796835,151.12357 C 43.874178,151.33686 43.979646,151.50561 44.113242,151.62982 C 44.221052,151.73295 44.337068,151.80912 44.461289,151.85834 C 44.587849,151.90522 44.724958,151.92865 44.872617,151.92865 C 45.212458,151.92865 45.479645,151.82553 45.674179,151.61928 C 45.868707,151.41069 45.965973,151.11186 45.965976,150.72279"
                    id="text4020" />
                    <path
                    style="font-size:7.20000029px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 46.618122,173.01714 L 44.24859,177.46793 L 43.496246,177.46793 L 46.01695,172.84839 L 43.035699,172.84839 L 43.035699,172.23316 L 46.618122,172.23316 L 46.618122,173.01714"
                    id="text4024" />
                    <path
                    style="font-size:7.19999981px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 157.01459,176.0245 C 157.01458,176.47685 156.83763,176.85302 156.48373,177.15302 C 156.13216,177.45302 155.68919,177.60302 155.15482,177.60302 C 154.58763,177.60302 154.13529,177.45654 153.79779,177.16357 C 153.46263,176.8706 153.29506,176.4956 153.29506,176.03857 C 153.29506,175.74794 153.37943,175.48544 153.54818,175.25107 C 153.71693,175.01435 153.95482,174.82685 154.26185,174.68857 L 154.26185,174.66747 C 153.9806,174.51748 153.77201,174.35341 153.63607,174.17529 C 153.50248,173.99716 153.43568,173.77451 153.43568,173.50732 C 153.43568,173.11357 153.5974,172.78545 153.92084,172.52294 C 154.24427,172.26045 154.6556,172.1292 155.15482,172.12919 C 155.67748,172.1292 156.09466,172.25459 156.40638,172.50536 C 156.7181,172.75615 156.87396,173.0749 156.87396,173.46161 C 156.87396,173.69834 156.80013,173.93154 156.65248,174.16122 C 156.50482,174.38857 156.28802,174.56669 156.00209,174.6956 L 156.00209,174.71669 C 156.33021,174.85732 156.58099,175.03076 156.75443,175.237 C 156.92786,175.44326 157.01458,175.70576 157.01459,176.0245 M 156.18138,173.46864 C 156.18138,173.21787 156.08412,173.01865 155.88959,172.87099 C 155.6974,172.72099 155.4513,172.64599 155.15131,172.64599 C 154.85599,172.64599 154.61341,172.71631 154.42357,172.85693 C 154.23607,172.99756 154.14232,173.1874 154.14232,173.42646 C 154.14232,173.59521 154.1892,173.7417 154.28295,173.86591 C 154.37904,173.98779 154.52318,174.09677 154.71537,174.19286 C 154.80209,174.23505 154.9263,174.29013 155.08802,174.3581 C 155.25208,174.42607 155.41146,174.48232 155.56615,174.52685 C 155.79818,174.37216 155.95872,174.21162 156.04779,174.04521 C 156.13685,173.8788 156.18138,173.68662 156.18138,173.46864 M 156.29037,176.0913 C 156.29037,175.87568 156.24232,175.70341 156.14623,175.5745 C 156.05247,175.44326 155.86732,175.31201 155.59076,175.18075 C 155.4806,175.12919 155.3599,175.08115 155.22865,175.03661 C 155.0974,174.99208 154.92279,174.92998 154.70482,174.85029 C 154.49388,174.96513 154.32396,175.12099 154.19506,175.31786 C 154.06849,175.51474 154.00521,175.7374 154.00521,175.98583 C 154.00521,176.30224 154.1142,176.56357 154.33217,176.76982 C 154.55013,176.97607 154.82669,177.07919 155.16185,177.07919 C 155.50404,177.07919 155.77708,176.9913 155.98099,176.81552 C 156.18724,176.63974 156.29037,176.39833 156.29037,176.0913"
                    id="text4028" />
                    <path
                    style="font-size:7.19999981px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 157.00755,149.53762 C 157.00755,149.99465 156.95481,150.40949 156.84935,150.78215 C 156.74622,151.15481 156.58919,151.47238 156.37825,151.73488 C 156.16497,152.00207 155.89778,152.20832 155.57669,152.35363 C 155.25559,152.49895 154.87825,152.5716 154.44466,152.5716 C 154.32278,152.5716 154.20794,152.56457 154.10013,152.55051 C 153.99231,152.53879 153.89622,152.51887 153.81185,152.49074 L 153.81185,151.81926 L 153.847,151.81926 C 153.91497,151.85441 154.01106,151.8884 154.13528,151.92121 C 154.2595,151.95168 154.39778,151.96691 154.55013,151.96691 C 155.06809,151.96691 155.47356,151.81223 155.76653,151.50285 C 156.06184,151.19113 156.23294,150.76223 156.27982,150.21613 C 156.06184,150.34739 155.85677,150.44114 155.66458,150.49738 C 155.47239,150.55363 155.26263,150.58176 155.03528,150.58176 C 154.81966,150.58176 154.62395,150.56067 154.44818,150.51848 C 154.27474,150.47629 154.10013,150.39426 153.92435,150.27238 C 153.7181,150.12942 153.56224,149.94778 153.45677,149.72746 C 153.35364,149.50715 153.30208,149.24348 153.30208,148.93645 C 153.30208,148.40207 153.47786,147.96731 153.82943,147.63215 C 154.18099,147.297 154.60989,147.12942 155.11614,147.12941 C 155.36927,147.12942 155.60364,147.16926 155.81927,147.24895 C 156.03489,147.32629 156.22356,147.44348 156.38528,147.60051 C 156.5845,147.79504 156.73801,148.04583 156.84583,148.35285 C 156.95364,148.65754 157.00755,149.05246 157.00755,149.53762 M 156.29739,149.38645 C 156.29739,149.02317 156.25989,148.73137 156.18489,148.51105 C 156.10989,148.29075 156.00677,148.11965 155.87552,147.99777 C 155.76536,147.89231 155.647,147.81731 155.52044,147.77277 C 155.39388,147.7259 155.25677,147.70247 155.10911,147.70246 C 154.77161,147.70247 154.50442,147.80793 154.30755,148.01887 C 154.11302,148.22981 154.01575,148.52629 154.01575,148.90832 C 154.01575,149.13098 154.04739,149.31262 154.11068,149.45324 C 154.17395,149.59387 154.2806,149.71692 154.4306,149.82238 C 154.53606,149.89504 154.65208,149.94426 154.77864,149.97004 C 154.9052,149.99348 155.04583,150.0052 155.20052,150.0052 C 155.38333,150.0052 155.56848,149.98059 155.75599,149.93137 C 155.94348,149.88215 156.11927,149.81067 156.28333,149.71691 C 156.28567,149.6677 156.28802,149.61965 156.29036,149.57277 C 156.29505,149.52356 156.29739,149.46145 156.29739,149.38645"
                    id="text4032" />
                    <path
                    style="font-size:7.19999981px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 154.13354,127.45059 L 151.29995,127.45059 L 151.29995,126.91622 L 152.38979,126.91622 L 152.38979,123.40762 L 151.29995,123.40762 L 151.29995,122.9295 C 151.4476,122.9295 151.6058,122.91778 151.77455,122.89434 C 151.9433,122.86856 152.07104,122.83224 152.15776,122.78536 C 152.26557,122.72677 152.34994,122.65294 152.41088,122.56387 C 152.47416,122.47247 152.51049,122.3506 152.51987,122.19825 L 153.06479,122.19825 L 153.06479,126.91622 L 154.13354,126.91622 L 154.13354,127.45059 M 159.00971,124.83145 C 159.00971,125.7713 158.86205,126.46153 158.56674,126.90215 C 158.27377,127.34043 157.81791,127.55957 157.19916,127.55957 C 156.57104,127.55957 156.11166,127.33692 155.82104,126.89161 C 155.53276,126.44629 155.38862,125.76192 155.38862,124.83848 C 155.38862,123.90802 155.5351,123.2213 155.82807,122.77832 C 156.12104,122.33302 156.57807,122.11036 157.19916,122.11036 C 157.82729,122.11036 158.28549,122.33653 158.57377,122.78887 C 158.86439,123.23888 159.00971,123.91973 159.00971,124.83145 M 158.0851,126.42754 C 158.16713,126.2377 158.22221,126.01504 158.25034,125.75957 C 158.2808,125.50176 158.29604,125.19239 158.29604,124.83145 C 158.29604,124.4752 158.2808,124.16583 158.25034,123.90332 C 158.22221,123.64083 158.16596,123.41817 158.08159,123.23536 C 157.99955,123.05489 157.88705,122.91895 157.74409,122.82754 C 157.60346,122.73614 157.42182,122.69044 157.19916,122.69043 C 156.97885,122.69044 156.79604,122.73614 156.65073,122.82754 C 156.50776,122.91895 156.39408,123.05724 156.30971,123.24239 C 156.23002,123.41583 156.17494,123.642 156.14448,123.9209 C 156.11635,124.19981 156.10229,124.50567 156.10229,124.83848 C 156.10229,125.20411 156.11518,125.50997 156.14096,125.75606 C 156.16674,126.00215 156.22182,126.22247 156.30619,126.417 C 156.38354,126.59981 156.49252,126.73926 156.63315,126.83536 C 156.77611,126.93145 156.96479,126.9795 157.19916,126.9795 C 157.41947,126.9795 157.60229,126.93379 157.7476,126.84239 C 157.89291,126.75098 158.00541,126.6127 158.0851,126.42754"
                    id="text4036" />
                    <path
                    style="font-size:7.19999981px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 154.27941,102.44554 L 151.44582,102.44554 L 151.44582,101.91116 L 152.53566,101.91116 L 152.53566,98.402571 L 151.44582,98.402571 L 151.44582,97.924446 C 151.59347,97.924451 151.75168,97.912732 151.92043,97.88929 C 152.08918,97.863513 152.21691,97.827185 152.30363,97.780305 C 152.41144,97.721716 152.49582,97.647888 152.55676,97.558821 C 152.62004,97.46742 152.65636,97.345545 152.66574,97.193196 L 153.21066,97.193196 L 153.21066,101.91116 L 154.27941,101.91116 L 154.27941,102.44554 M 158.86379,102.44554 L 156.03019,102.44554 L 156.03019,101.91116 L 157.12004,101.91116 L 157.12004,98.402571 L 156.03019,98.402571 L 156.03019,97.924446 C 156.17785,97.924451 156.33605,97.912732 156.5048,97.88929 C 156.67355,97.863513 156.80129,97.827185 156.88801,97.780305 C 156.99582,97.721716 157.08019,97.647888 157.14113,97.558821 C 157.20441,97.46742 157.24074,97.345545 157.25012,97.193196 L 157.79504,97.193196 L 157.79504,101.91116 L 158.86379,101.91116 L 158.86379,102.44554"
                    id="text4040" />
                    <path
                    style="font-size:7.19999981px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 154.13,77.475691 L 151.29641,77.475691 L 151.29641,76.941316 L 152.38625,76.941316 L 152.38625,73.432722 L 151.29641,73.432722 L 151.29641,72.954597 C 151.44406,72.954602 151.60226,72.942883 151.77101,72.919441 C 151.93976,72.893665 152.0675,72.857336 152.15422,72.810457 C 152.26203,72.751868 152.3464,72.67804 152.40734,72.588972 C 152.47062,72.497571 152.50695,72.375696 152.51633,72.223347 L 153.06125,72.223347 L 153.06125,76.941316 L 154.13,76.941316 L 154.13,77.475691 M 159.0132,77.475691 L 155.46945,77.475691 L 155.46945,76.740925 C 155.71554,76.529989 155.96164,76.319052 156.20773,76.108113 C 156.45617,75.897177 156.68703,75.687412 156.90031,75.478816 C 157.35031,75.042881 157.65851,74.697178 157.82492,74.441707 C 157.99132,74.183898 158.07453,73.906164 158.07453,73.608504 C 158.07453,73.336633 157.98429,73.124524 157.80383,72.972176 C 157.6257,72.817493 157.37609,72.740149 157.055,72.740144 C 156.84172,72.740149 156.61086,72.777649 156.36242,72.852644 C 156.11398,72.927649 155.8714,73.042493 155.63469,73.197176 L 155.59953,73.197176 L 155.59953,72.458894 C 155.76594,72.376868 155.98742,72.301868 156.26398,72.233894 C 156.54289,72.165931 156.81242,72.131947 157.07258,72.131941 C 157.60929,72.131947 158.03,72.262025 158.33469,72.522176 C 158.63937,72.779993 158.79171,73.130383 158.79172,73.573347 C 158.79171,73.77257 158.76593,73.958898 158.71437,74.132332 C 158.66515,74.303429 158.59132,74.466319 158.49289,74.621004 C 158.40148,74.766319 158.29367,74.909287 158.16945,75.04991 C 158.04757,75.190537 157.89875,75.346396 157.72297,75.517488 C 157.47218,75.763583 157.2132,76.002646 156.94601,76.234676 C 156.67882,76.464364 156.42922,76.677645 156.19719,76.874519 L 159.0132,76.874519 L 159.0132,77.475691"
                    id="text4044" />
                    <path
                    style="font-size:7.19999981px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 154.16692,52.405653 L 151.33333,52.405653 L 151.33333,51.871278 L 152.42317,51.871278 L 152.42317,48.362685 L 151.33333,48.362685 L 151.33333,47.88456 C 151.48099,47.884564 151.63919,47.872845 151.80794,47.849403 C 151.97669,47.823627 152.10442,47.787299 152.19114,47.740419 C 152.29895,47.68183 152.38333,47.608002 152.44427,47.518935 C 152.50755,47.427533 152.54388,47.305658 152.55325,47.15331 L 153.09817,47.15331 L 153.09817,51.871278 L 154.16692,51.871278 L 154.16692,52.405653 M 158.58958,49.88495 C 158.70208,49.985734 158.79466,50.112296 158.86732,50.264638 C 158.93997,50.416983 158.9763,50.613858 158.9763,50.855263 C 158.9763,51.094326 158.93294,51.313467 158.84622,51.512685 C 158.7595,51.711904 158.63762,51.885341 158.4806,52.032997 C 158.30481,52.19706 158.09739,52.318935 157.85833,52.398622 C 157.62161,52.475966 157.36145,52.514638 157.07786,52.514638 C 156.78724,52.514638 156.5013,52.479481 156.22005,52.409169 C 155.9388,52.3412 155.70794,52.2662 155.52747,52.184169 L 155.52747,51.449403 L 155.58021,51.449403 C 155.77942,51.580654 156.0138,51.689638 156.28333,51.776356 C 156.55286,51.863076 156.81302,51.906435 157.0638,51.906435 C 157.21145,51.906435 157.36848,51.881826 157.53489,51.832606 C 157.7013,51.783388 157.83606,51.710732 157.93919,51.614638 C 158.047,51.511514 158.12669,51.397842 158.17825,51.273622 C 158.23216,51.149405 158.25911,50.992373 158.25911,50.802528 C 158.25911,50.61503 158.22864,50.460343 158.16771,50.338466 C 158.10911,50.214249 158.02708,50.116984 157.92161,50.046669 C 157.81614,49.974015 157.68841,49.924796 157.53841,49.899013 C 157.38841,49.87089 157.22669,49.856828 157.05325,49.856825 L 156.73685,49.856825 L 156.73685,49.273231 L 156.98294,49.273231 C 157.33919,49.273235 157.62278,49.199407 157.83372,49.051747 C 158.047,48.901751 158.15364,48.683782 158.15364,48.397841 C 158.15364,48.271283 158.12669,48.161126 158.07278,48.067372 C 158.01887,47.971283 157.94387,47.892767 157.84778,47.831825 C 157.747,47.770892 157.63919,47.728705 157.52435,47.705263 C 157.4095,47.68183 157.27942,47.670111 157.13411,47.670107 C 156.91145,47.670111 156.67474,47.709955 156.42396,47.789638 C 156.17317,47.86933 155.93646,47.98183 155.7138,48.127138 L 155.67864,48.127138 L 155.67864,47.392372 C 155.84505,47.310346 156.06653,47.235346 156.3431,47.167372 C 156.622,47.097065 156.89153,47.061909 157.15169,47.061903 C 157.40716,47.061909 157.63216,47.085346 157.82669,47.132216 C 158.02122,47.179096 158.197,47.254096 158.35403,47.357216 C 158.52278,47.469721 158.65051,47.605658 158.73724,47.765028 C 158.82395,47.924408 158.86731,48.110736 158.86732,48.324013 C 158.86731,48.614642 158.76419,48.868938 158.55794,49.086903 C 158.35403,49.302531 158.11262,49.438469 157.83372,49.494716 L 157.83372,49.543935 C 157.94622,49.562687 158.07512,49.602531 158.22044,49.663466 C 158.36575,49.722062 158.4888,49.79589 158.58958,49.88495"
                    id="text4048" />
                    <path
                    style="font-size:7.19999981px;font-style:normal;font-weight:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Bitstream Vera Sans"
                    d="M 154.07025,27.398918 L 151.23665,27.398918 L 151.23665,26.864543 L 152.3265,26.864543 L 152.3265,23.35595 L 151.23665,23.35595 L 151.23665,22.877825 C 151.38431,22.877829 151.54251,22.866111 151.71126,22.842669 C 151.88001,22.816892 152.00774,22.780564 152.09446,22.733684 C 152.20227,22.675095 152.28665,22.601267 152.34759,22.5122 C 152.41087,22.420799 152.4472,22.298924 152.45657,22.146575 L 153.0015,22.146575 L 153.0015,26.864543 L 154.07025,26.864543 L 154.07025,27.398918 M 159.07298,25.925872 L 158.29603,25.925872 L 158.29603,27.398918 L 157.62103,27.398918 L 157.62103,25.925872 L 155.11439,25.925872 L 155.11439,25.117278 L 157.64915,22.164153 L 158.29603,22.164153 L 158.29603,25.363372 L 159.07298,25.363372 L 159.07298,25.925872 M 157.62103,25.363372 L 157.62103,23.000872 L 155.59251,25.363372 L 157.62103,25.363372"
                    id="text4052" />
                    <path
                    style="fill:none;fill-opacity:0.75;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                    d="M 90.5,10 L 90.5,15 C 90.5,15 90.5,25 100.5,25 C 110.5,25 110.5,15 110.5,15 L 110.5,10 L 90.5,10 z "
                    id="path13108" />
                </g>
                </svg>
        </div>
    </div>
    <div class="canvas-container">
        <canvas id="myCanvas" width="4000" height="4000" ondblclick="editShapeLabel(event)"></canvas>
    </div>
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');

        // Definir el tamaño de los cuadros en el patrón
        const cuadroSize = 10;

        // Definir colores para las líneas del patrón
        const colorLineaPrincipal = '#e5e4e2'; // Color de las líneas principales (Isabelline)
        const colorLineaSecundaria = '#f4f0ec'; // Color de las líneas secundarias
        const colorRectangulo = '#b2beb5'; // Color de los rectángulos
        const grosorRectangulo = 2; // Grosor de línea de los rectángulos

        // Obtener el tamaño del canvas
        const canvasWidth = canvas.width;
        const canvasHeight = canvas.height;

        function drawPattern() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight); // Borrar el canvas

            // Dibujar los puntos
            ctx.fillStyle = colorLineaPrincipal;
            const radioPunto = 2; // Tamaño del radio de los puntos
            for (let x = 0; x <= canvasWidth; x += cuadroSize) {
                for (let y = 0; y <= canvasHeight; y += cuadroSize) {
                    ctx.beginPath();
                    ctx.arc(x, y, radioPunto, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }


        // Llama a la función para dibujar el patrón cuadriculado cuando la página se carga
        drawPattern();

        const zoomSlider = document.getElementById('zoomSlider');
        const zoomValue = document.getElementById('zoomValue');
        const canvasContainer = document.querySelector('.canvas-container');

        function zoomCanvas() {
            const zoomLevel = zoomSlider.value;
            zoomValue.textContent = `${zoomLevel}%`;

            // Calcula el nuevo ancho y alto del canvas según el zoom
            const newWidth = (canvas.width * zoomLevel) / 100;
            const newHeight = (canvas.height * zoomLevel) / 100;

            // Actualiza el tamaño del canvas
            canvas.style.width = `${newWidth}px`;
            canvas.style.height = `${newHeight}px`;

            // Permite el overflow en el contenedor del canvas
            canvasContainer.style.overflow = 'auto';

            // Redibuja el contenido del canvas
            redraw();
        }

        function adjustShapes(scale) {
            // Ajusta las coordenadas y el tamaño de las figuras
            for (const shape of shapes) {
                shape.x *= scale;
                shape.y *= scale;
                shape.width *= scale;
                shape.height *= scale;

                for (const output of shape.outputs) {
                    output.x *= scale;
                    output.y *= scale;
                }

                for (const input of shape.inputs) {
                    input.x *= scale;
                    input.y *= scale;
                }
            }
        }

        function adjustCanvasSize(scale) {
            // Actualiza el tamaño del canvas
            canvas.width = canvas.width * scale;
            canvas.height = canvas.height * scale;

            // Ajusta el estilo del canvas para que refleje el nuevo tamaño
            canvas.style.width = `${canvas.width}px`;
            canvas.style.height = `${canvas.height}px`;

            // Habilita el overflow en el contenedor del canvas
            canvasContainer.style.overflow = 'auto';
        }

        let isEditingLabel = false; // Variable para controlar la edición del label
        let editedShape = null; // Variable para rastrear la forma en edición

        function editShapeLabel(event) {
            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            // Verifica si se hizo doble clic en una forma para editar su label
            for (const shape of shapes) {
                if (
                    mouseX >= shape.x && mouseX <= shape.x + shape.width &&
                    mouseY >= shape.y && mouseY <= shape.y + shape.height
                ) {
                    isEditingLabel = true;
                    editedShape = shape;
                    const newLabel = prompt("Editar label:", editedShape.label); // Muestra un cuadro de diálogo para editar el label
                    if (newLabel !== null) { // Comprueba si se ingresó un nuevo label
                        editedShape.label = newLabel;
                        redraw();
                    }
                    return;
                }
            }
        }

        function toggleShapeGroup(button) {
            var content = button.nextElementSibling;

            if (content.style.display === "block") {
                content.style.display = "none";
            } else {
                content.style.display = "block";
            }
        }
       
        ctx.lineWidth = 3;

        let isDrawingConnector = false;
        let startShape = null;
        let startOutput = null;
        let endShape = null;
        let endInput = null;
        let shapes = [];
        let connectors = [];

        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let selectedShape = null;
        let selectedConnector = null;

        canvas.addEventListener('mousedown', (event) => {
            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            // Verifica si se hizo clic en un output de un shape
            for (const shape of shapes) {
                if(shape.type!="Text"){
                    for (const output of shape.outputs) {
                        if (
                            mouseX >= shape.x + output.x - 6 && mouseX <= shape.x + output.x + 6 &&
                            mouseY >= shape.y + output.y - 6 && mouseY <= shape.y + output.y + 6
                        ) {
                            isDrawingConnector = true;
                            startShape = shape;
                            startOutput = output;
                            return;
                        }
                    }
                }
            }

            // Verifica si se hizo clic en una forma para moverla
            for (const shape of shapes) {
                if (
                    mouseX >= shape.x && mouseX <= shape.x + shape.width &&
                    mouseY >= shape.y && mouseY <= shape.y + shape.height
                ) {
                    isDragging = true;
                    selectedShape = shape;
                    dragStartX = mouseX;
                    dragStartY = mouseY;
                    dragOffsetX = mouseX - shape.x;
                    dragOffsetY = mouseY - shape.y;
                    return;
                }
            }

        });

        canvas.addEventListener('mousemove', (event) => {
            if (isDragging) {
                const mouseX = event.offsetX;
                const mouseY = event.offsetY;
                selectedShape.x = mouseX - dragOffsetX;
                selectedShape.y = mouseY - dragOffsetY;
                updateConnectors(selectedShape);
                redraw();
            }
        });

        canvas.addEventListener('mouseup', (event) => {
            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            if (isDrawingConnector) {
                // Verifica si se hizo clic en un input de un shape
                for (const shape of shapes) {
                    for (const input of shape.inputs) {
                        if (
                            mouseX >= shape.x + input.x - 6 && mouseX <= shape.x + input.x + 6 &&
                            mouseY >= shape.y + input.y - 6 && mouseY <= shape.y + input.y + 6
                        ) {
                            endShape = shape;
                            endInput = input;

                            // Crea un conector desde el output al input
                            createConnector(startShape, startOutput, endShape, endInput);

                            isDrawingConnector = false;
                            startShape = null;
                            startOutput = null;
                            endShape = null;
                            endInput = null;

                            redraw();
                            return;
                        }
                    }
                }
            }

            if (isDragging) {
                isDragging = false;
                // selectedShape = null;
            }
        });

        function evaluateShapes() {
            for (const shape of shapes) {
                if (shape.type === "AND" || shape.type === "OR" || shape.type === "NOT" || shape.type === "NAND" || shape.type === "NOR"  || shape.type === "NAND3" || shape.type === "NOR3" || shape.type === "XOR" || shape.type === "XNOR" || shape.type === "AND3" || shape.type === "AND4" || shape.type === "AND5" || shape.type === "OR3" || shape.type === "OR4" || shape.type === "OR5" || shape.type === "Pin14") {
                    evaluateGate(shape);
                }
                if(shape.type === "OutPutL"){
                    evaluateOutput(shape);
                }
                if(shape.type=="Display"){
                    evaluateDisplay(shape);
                }
            }
        }

        canvas.addEventListener('dblclick', (event) => {
            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            // Verifica si se hizo doble clic en una forma InputL
            for (const shape of shapes) {
                if (
                    shape.type === "InputL" &&
                    mouseX >= shape.x && mouseX <= shape.x + shape.width &&
                    mouseY >= shape.y && mouseY <= shape.y + shape.height
                ) {
                    toggleInputColor(shape);
                    evaluateShapes();
                    redraw();
                    return;
                }

                if (
                    shape.type === "Clock" &&
                    mouseX >= shape.x && mouseX <= shape.x + shape.width &&
                    mouseY >= shape.y && mouseY <= shape.y + shape.height
                ) {
                    toggleClock(shape);
                    return;
                }

                // Verifica si se hizo doble clic en una forma AND, OR, NOT o OutPutL
                if (
                    (shape.type === "AND" || shape.type === "OR" || shape.type === "NOT" || shape.type === "OutPutL" || shape.type === "NAND" || shape.type === "NOR"  || shape.type === "NAND3" || shape.type === "NOR3" || shape.type === "XOR" || shape.type === "XNOR" || shape.type === "AND3"  || shape.type === "AND4"  || shape.type === "AND5" || shape.type === "OR3" || shape.type === "OutPutL") &&
                    mouseX >= shape.x && mouseX <= shape.x + shape.width &&
                    mouseY >= shape.y && mouseY <= shape.y + shape.height
                ) {
                    if (shape.type === "OutPutL") {
                        evaluateOutput(shape);
                    } else {
                        evaluateGate(shape);
                    }
                    redraw();
                    return;
                }

                if (
                    shape.type === 'Text' &&
                    mouseX >= shape.x && mouseX <= shape.x + shape.width &&
                    mouseY >= shape.y && mouseY <= shape.y + shape.height
                ) {
                    // Solicita al usuario que ingrese o modifique el contenido del cuadro de texto
                    const newText = prompt('Ingrese el nuevo contenido del cuadro de texto:', shape.label);
                    if (newText !== null) {
                        shape.label = newText;
                        redraw();
                    }
                    return;
                }

            }

        });

        function createConnector(startShape, startOutput, endShape, endInput) {
            // Crea un conector desde el output al input
            const connector = {
                startShape,
                endShape,
                startOutput,
                endInput,
                isSelected: false
            };
            connectors.push(connector);
            /*
            // Imprimir información en la consola
            console.log("Nueva conexión creada:");
            console.log("Forma de origen:", startShape.label, startShape.type);
            console.log("Output de origen:", startOutput.label);
            console.log("Forma de destino:", endShape.label, endShape.type);
            console.log("Input de destino:", endInput.label);
            */
            // Verificar si es una conexión a InputL y actualizar el color y Output A
            if (endShape.type === "InputL") {
                toggleInputColor(endShape);
            }
        }

        function toggleInputColor(inputShape) {
            inputShape.color = inputShape.color === "red" ? "green" : "red";
            inputShape.outputs[0].label = `Output A: ${inputShape.color === "red" ? '0' : '1'}`;
        }

  function evaluateGate(gateShape) {
            // Obtener las conexiones entrantes al AND, OR o NOT
            const inputConnections = connectors.filter(connector => connector.endShape === gateShape);
           
            // Crear un arreglo para almacenar los valores de entrada
            const inputValues = inputConnections.map(connection => {
                return connection.startShape.outputs[0].label === "Output A: 1";
            });

            // Evaluar la operación lógica AND, OR o NOT
            let outputValues = [];
            if (gateShape.type === "AND" || gateShape.type === "AND3" || gateShape.type === "AND4" || gateShape.type === "AND5") {
                outputValues.push(inputValues.every(value => value === true));
            } else if (gateShape.type === "OR" || gateShape.type === "OR3" || gateShape.type === "OR4" || gateShape.type === "OR5") {
                outputValues.push(inputValues.some(value => value === true));
            } else if (gateShape.type === "NOT") {
                outputValues.push(!inputValues[0]);
            } else if (gateShape.type === "NAND" || gateShape.type === "NAND3") {
                outputValues.push(!(inputValues.every(value => value === true)));
            } else if (gateShape.type === "NOR" || gateShape.type === "NOR3") {
                outputValues.push(!(inputValues.some(value => value === true)));
            } else if (gateShape.type === "XOR" || gateShape.type === "XNOR") {
                // XOR y XNOR pueden tener múltiples salidas
                outputValues = inputValues.map(value => {
                    return gateShape.type === "XOR" ? (value ? 0 : 1) : (value ? 1 : 0);
                });
            } else if (gateShape.type === "Pin14") {
                // Pin14 pueden tener múltiples salidas
                bcdInput = '';
               
                result = false;

                for (const connection of inputConnections) {
                    const inputValue = connection.startShape.outputs[0].label === "Output A: 1";
                   
                    if(inputValue){
                        bcdInput = bcdInput + '1';
                    } else {
                        bcdInput = bcdInput + '0';
                    }
 
                    result = inputValue;
 
                }

                var segments = bcdToSegments(bcdInput);


                for (let i = 0; i < gateShape.outputs.length; i++) {

                    gateShape.outputs[i].label = `Output ${String.fromCharCode(65 + i)}: ${segments[i] ? '1' : '0'}`;
                }
               
            }

            if (gateShape.type != "Pin14") {
                // Actualizar el color y las etiquetas de salida según los resultados
                gateShape.color = outputValues.every(value => value === true) ? "green" : "red";
                for (let i = 0; i < gateShape.outputs.length; i++) {
                    gateShape.outputs[i].label = `Output ${String.fromCharCode(65 + i)}: ${outputValues[i] ? '1' : '0'}`;
                }
            }
        }


        function evaluateOutput(outputShape) {
            // Obtener las conexiones entrantes al AND, OR o NOT
            const inputConnection = connectors.find(connector => connector.endShape === outputShape);

            if (inputConnection) {
                // Obtener el valor del conector
                const inputValue = inputConnection.startShape.outputs[0].label === "Output A: 1";

                // Cambiar el color de OutPutL según el valor del conector
                outputShape.color = inputValue ? "green" : "red";
            }
        }

        function evaluateDisplay(displayShape){
            // Obtener las conexiones entrantes al AND, OR o NOT
            const inputConnections = connectors.filter(connector => connector.endShape === displayShape);

            for (const connection of inputConnections) {
                const inputValue = connection.startShape.outputs[0].label === "Output A: 1";
                segmentColor = inputValue ? "blue" : "gray";
                ctx.fillStyle = segmentColor; // Establece el color segun el input
                segmentValue = inputValue ? "1" : "0";
                // console.log(connection.endInput.label+": "+segmentValue);
                polygon = connection.endInput.label.split('')[connection.endInput.label.length - 1];
                drawPolygon(displayShape,polygons[polygon.toLowerCase()],6);
            }

        }

        function updateConnectors(updatedShape) {
            for (const connector of connectors) {
                if (connector.startShape === updatedShape || connector.endShape === updatedShape) {
                    connector.startOutput.x = connector.startShape.outputs[0].x;
                    connector.startOutput.y = connector.startShape.outputs[0].y;
                    for(i = 0; i < connector.endShape.inputs.lenght; i++){
                        connector.endInput.x = connector.endShape.inputs[i].x;
                        connector.endInput.y = connector.endShape.inputs[i].y;
                    }
                }
            }
        }

        function redraw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPattern();
            booleanMath = 'F = ';
            for (const shape of shapes) {
                drawShape(shape);
                booleanMath = booleanMath + getBooleanExpressionForShape(shape);
            }

            for (const connector of connectors) {
                drawConnector(connector);
            }

            console.log(booleanMath);
            evaluateShapes();


        }

        // Define las coordenadas de los vértices para cada polígono
        var polygons = {
            a: [[1, 1], [2, 0], [8, 0], [9, 1], [8, 2], [2, 2]],
            b: [[9, 1], [10, 2], [10, 8], [9, 9], [8, 8], [8, 2]],
            c: [[9, 9], [10, 10], [10, 16], [9, 17], [8, 16], [8, 10]],
            d: [[9, 17], [8, 18], [2, 18], [1, 17], [2, 16], [8, 16]],
            e: [[1, 17], [0, 16], [0, 10], [1, 9], [2, 10], [2, 16]],
            f: [[1, 9], [0, 8], [0, 2], [1, 1], [2, 2], [2, 8]],
            g: [[1, 9], [2, 8], [8, 8], [9, 9], [8, 10], [2, 10]]
        };

        // Función para dibujar un polígono en el canvas
        function drawPolygon(shape,vertices, size) {
            // console.log(vertices);
            ctx.beginPath();
            ctx.moveTo(shape.x+vertices[0][0]*size, shape.y+vertices[0][1]*size);
            for (var i = 1; i < vertices.length; i++) {
                ctx.lineTo(shape.x+vertices[i][0]*size, shape.y+vertices[i][1]*size);
            }
            ctx.closePath();
            ctx.fill();
        }

        function drawConnector(connector) {
           
            const startX = connector.startShape.x + connector.startOutput.x;
            const startY = connector.startShape.y + connector.startOutput.y;
            const endX = connector.endShape.x + connector.endInput.x;
            const endY = connector.endShape.y + connector.endInput.y;

            // Puntos de control para curvas
            const controlPointX1 = startX + 30;
            const controlPointY1 = startY;
            const controlPointX2 = endX - 30;
            const controlPointY2 = endY;

            // Dibuja la línea de relación
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            if (connector.isSelected) {
                ctx.strokeStyle = 'blue'; // Cambia el color a azul si está seleccionado
            } else {
                ctx.strokeStyle = 'black'; // Restablece el color normal
            }
            ctx.lineTo(controlPointX1, controlPointY1);
            ctx.quadraticCurveTo(startX, startY, controlPointX1, controlPointY1);
            ctx.lineTo(controlPointX2, controlPointY2);
            ctx.quadraticCurveTo(endX, endY, controlPointX2, controlPointY2);
            ctx.lineTo(endX, endY);
            ctx.stroke();

            /*
            ctx.beginPath();
            ctx.moveTo(connector.startShape.x + connector.startOutput.x, connector.startShape.y + connector.startOutput.y);
            ctx.lineTo(connector.endShape.x + connector.endInput.x, connector.endShape.y + connector.endInput.y);
            ctx.stroke();
            */
        }

        function drawShape(shape) {                        
            ctx.beginPath();
            // ctx.rect(shape.x, shape.y, shape.width, shape.height);
            // ctx.stroke();
       
        if(shape.type=="Text"){
            moveLabel = 0;
        } else if(shape.type=="Component"){
            moveLabel = 0;    
        } else if(shape.type=="Display"){
            moveLabel =  75;
            // Dibuja cada uno de los polígonos
            for (var key in polygons) {
                if (polygons.hasOwnProperty(key)) {
                    //  console.log(key);
                    ctx.fillStyle = "gray";
                    drawPolygon(shape,polygons[key],6);
                }
            }
        } else if(shape.type=="Pin14"){
            moveLabel =  150;
            drawIC(shape.x, shape.y, 100, 180, 7);
        } else {
            if(shape.type=="D_Flip_Flop" || shape.type=="T_Flip_Flop" || shape.type=="JK_Flip_Flop"){
                moveLabel = 55;
            } else {
                moveLabel = 10;
            }    
            var svgURL = new XMLSerializer().serializeToString(document.getElementById(shape.type));
            var img = new Image();
            img.onload = function () {
                ctx.drawImage(this, shape.x, shape.y);
            };
            img.src = 'data:image/svg+xml; charset=utf8, ' + encodeURIComponent(svgURL);
        }

            // Cambiar el color de la forma InputL, AND, OR, NOT o OutPutL
            if (shape.type === "InputL" || shape.type === "AND" || shape.type === "OR" || shape.type === "NOT" || shape.type === "NAND" || shape.type === "NOR" || shape.type === "NAND3" || shape.type === "NOR3" || shape.type === "XOR" || shape.type === "XNOR" || shape.type === "AND3" || shape.type === "AND4" || shape.type === "AND5" || shape.type === "OR3" || shape.type === "OR4" || shape.type === "OR5" || shape.type === "OutPutL" || shape.type === "Pin14") {
                ctx.fillStyle = shape.color;
                 //ctx.fillRect(shape.x, shape.y, shape.width, shape.height);
            }

            if(shape.type!="Text"){
                // Dibuja los puntos de entrada (inputs) y salida (outputs)
                for (const output of shape.outputs) {
                    drawCircle({ x: shape.x + output.x, y: shape.y + output.y });
                    drawText({ x: shape.x + output.x, y: shape.y + output.y }, output.label);
                }

                for (const input of shape.inputs) {
                    drawCircle({ x: shape.x + input.x, y: shape.y + input.y});
                    drawText({ x: shape.x + input.x, y: shape.y + input.y }, input.label);
                }
            }

            // Dibuja el nombre del tipo de forma en el centro
            ctx.font = '14px Arial';
            ctx.fillStyle = shape.color;
            ctx.textAlign = 'center';
            ctx.fillText(shape.label, shape.x + shape.width / 2, shape.y + shape.height + moveLabel);
        }

        function drawCircle(point) {
            ctx.beginPath();
            ctx.arc(point.x, point.y, 6, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawText(point, text) {
            ctx.font = '12px Arial';
            ctx.fillStyle = 'black';
            ctx.fillText(text, point.x + 10, point.y - 10);
        }

        // Función para iniciar el arrastre de una
        function drag(event) {
            event.dataTransfer.setData("text", event.target.getAttribute("data-shape-type"));
        }

        // Función para permitir soltar formas en el lienzo
        canvas.addEventListener('dragover', (event) => {
            event.preventDefault();
        });

        // Función para manejar la soltura de formas en el lienzo
        canvas.addEventListener('drop', (event) => {
            event.preventDefault();
            const shapeType = event.dataTransfer.getData("text");

            const mouseX = event.offsetX;
            const mouseY = event.offsetY;

            // Crear una nueva forma en la posición donde se soltó
            const newShape = {
                type: shapeType,
                x: mouseX,
                y: mouseY,
                width: 100,
                height: 50,
                label: shapeType,
                inputs: [],
                outputs: [],
                name: randomName(),
                isRunning: false, // Indicador para controlar si el reloj está en funcionamiento
                intervalId: null, // Identificador del intervalo para el pulso
            };

            // Define los puntos de entrada y salida para las formas creadas desde la barra lateral
            if (shapeType === "InputL") {
                newShape.outputs.push({ x: 50, y: 25, label: `Output A: 0` });
                newShape.color = "red"; // Inicialmente rojo
            } else if (shapeType === "OutPutL") {
                newShape.inputs.push({ x: 0, y: 25, label: 'Input A' });

                // Evaluar el valor del OutputL al crearlo
                evaluateOutput(newShape);
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "Text") {
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "Clock") {
                newShape.outputs.push({ x: 50, y: 25, label: `Output A` });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "AND") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input B' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "OR") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input B' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "OR3") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 25, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input C' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "OR4") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 25, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input C' });
                newShape.inputs.push({ x: 0, y: 55, label: 'Input D' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "OR5") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 25, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input C' });
                newShape.inputs.push({ x: 0, y: 55, label: 'Input D' });
                newShape.inputs.push({ x: 0, y: 70, label: 'Input E' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "NOT") {
                newShape.inputs.push({ x: 0, y: 25, label: 'Input A' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output B' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "NAND") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input B' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "NOR") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input B' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "NAND3") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 70, label: 'Input C' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "NOR3") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 70, label: 'Input C' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "XOR") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input B' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "XNOR") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input B' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "AND3") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 25, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input C' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "AND4") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 25, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input C' });
                newShape.inputs.push({ x: 0, y: 55, label: 'Input D' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "AND5") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 25, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input C' });
                newShape.inputs.push({ x: 0, y: 55, label: 'Input D' });
                newShape.inputs.push({ x: 0, y: 70, label: 'Input E' });
                newShape.outputs.push({ x: 100, y: 25, label: 'Output A' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "Display") {
                newShape.inputs.push({ x: 0, y: 10, label: 'Input A' });
                newShape.inputs.push({ x: 0, y: 25, label: 'Input B' });
                newShape.inputs.push({ x: 0, y: 40, label: 'Input C' });
                newShape.inputs.push({ x: 0, y: 55, label: 'Input D' });
                newShape.inputs.push({ x: 0, y: 70, label: 'Input E' });
                newShape.inputs.push({ x: 0, y: 85, label: 'Input F' });
                newShape.inputs.push({ x: 0, y: 100, label: 'Input G' });
                newShape.color = "gray"; // Inicialmente gris
            } else if (shapeType === "D_Flip_Flop") {
                newShape.inputs.push({ x: 0, y: 30, label: 'D' });
                newShape.inputs.push({ x: 0, y: 70, label: 'CLK' });
                newShape.outputs.push({ x: 100, y: 30, label: 'Q' });
                newShape.outputs.push({ x: 100, y: 70, label: 'Q' });
            } else if (shapeType === "T_Flip_Flop") {
                newShape.inputs.push({ x: 0, y: 30, label: 'T' });
                newShape.inputs.push({ x: 0, y: 70, label: 'CLK' });
                newShape.outputs.push({ x: 100, y: 30, label: 'Q' });
                newShape.outputs.push({ x: 100, y: 70, label: 'Q' });
            } else if (shapeType === "JK_Flip_Flop") {
                newShape.inputs.push({ x: 0, y: 30, label: 'J' });
                newShape.inputs.push({ x: 0, y: 50, label: 'CLK' });
                newShape.inputs.push({ x: 0, y: 70, label: 'K' });
                newShape.outputs.push({ x: 100, y: 30, label: 'Q' });
                newShape.outputs.push({ x: 100, y: 70, label: 'Q' });
            } else if (shapeType === "Pin14") {
                newShape.inputs.push({ x: 20, y: 25, label: 'A' });
                newShape.inputs.push({ x: 20, y: 50, label: 'B' });
                newShape.inputs.push({ x: 20, y: 75, label: 'C' });
                newShape.inputs.push({ x: 20, y: 100, label: 'D' });
                newShape.inputs.push({ x: 20, y: 125, label: 'BI' });
                newShape.inputs.push({ x: 20, y: 150, label: 'RBO' });
                newShape.inputs.push({ x: 20, y: 175, label: 'LT' });
                newShape.outputs.push({ x: 175, y: 25, label: 'QA' });
                newShape.outputs.push({ x: 175, y: 50, label: 'QB' });
                newShape.outputs.push({ x: 175, y: 75, label: 'QC' });
                newShape.outputs.push({ x: 175, y: 100, label: 'QD' });
                newShape.outputs.push({ x: 175, y: 125, label: 'QE' });
                newShape.outputs.push({ x: 175, y: 150, label: 'QF' });
                newShape.outputs.push({ x: 175, y: 175, label: 'QG' });
                newShape.color = "gray"; // Inicialmente gris
            }

            shapes.push(newShape);

            // Redibujar para mostrar la nueva forma
            redraw();
        });

        function drawIC(x, y, ICWidth, ICHeight, ICNumPins) {

            var centerX =  x + ICWidth;
            var centerY =  y + 6;

            // Radio del círculo (parte superior del "cono")
            var radio = 10;

            // Ángulo inicial y final para dibujar la mitad del círculo (180 grados)
            var anguloInicial = 0;
            var anguloFinal = Math.PI;

            // Color de las figuras (negro)
            ctx.strokeStyle = "black";

            // Dibujar el círculo cortado sin relleno
            ctx.beginPath();
            ctx.arc(centerX, centerY, radio, anguloInicial, anguloFinal);
            ctx.lineTo(centerX, centerY); // Conectar con el centro
            ctx.stroke(); // Dibujar el trazo
            ctx.closePath();

            // Dibujar el rectángulo a partir del ecuador del círculo sin relleno
            ctx.strokeRect(centerX - ICWidth / 2, centerY, ICWidth, ICHeight); // Dibujar el trazo del rectángulo

            // Ancho y altura de los pines
            var pinAncho = 8;
            var pinAltura = 8;

            // Espacio entre los pines
            var espacioEntrePines = 17;

            // Distancia desde el centro hasta el borde del rectángulo, ajustada un poco hacia arriba
            var distanciaDesdeCentro = (ICHeight / ICWidth) - espacioEntrePines; // Ajuste de 10 unidades

            // Dibujar pines a la izquierda
            for (var i = 0; i < ICNumPins; i++) {
                var xPinIzquierda = centerX - ICWidth / 2 - pinAncho;
                var yPin = centerY - distanciaDesdeCentro + i * (pinAltura + espacioEntrePines);
                ctx.strokeRect(xPinIzquierda, yPin, pinAncho, pinAltura);
            }

            // Dibujar pines a la derecha
            for (var i = 0; i < ICNumPins; i++) {
                var xPinDerecha = centerX + ICWidth / 2;
                var yPin = centerY - distanciaDesdeCentro + i * (pinAltura + espacioEntrePines);
                ctx.strokeRect(xPinDerecha, yPin, pinAncho, pinAltura);
            }
        }

        function randomName() {
            const allowedchars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            let randomName = '';

            for (let i = 0; i < 5; i++) {
                const randomIndex = Math.floor(Math.random() * allowedchars.length);
                randomName += allowedchars.charAt(randomIndex);
            }

            return randomName;
        }

        // Función para iniciar o detener el reloj
        function toggleClock(clockShape) {
            if (clockShape.isRunning) {
                clearInterval(clockShape.intervalId); // Detiene el intervalo si el reloj estaba en funcionamiento
                clockShape.isRunning = false;
                clockShape.color = "red";
            } else {
               
                // Inicia el intervalo para generar un pulso cada segundo (ajusta el intervalo según tus necesidades)
                clockShape.intervalId = setInterval(() => {
                    // Cambia el estado del reloj
                    clockShape.color = clockShape.color === "red" ? "green" : "red";
                    // console.log(clockShape.color);
                    clockShape.outputs[0].label = `Output A: ${clockShape.color === "red" ? '0' : '1'}`;
                    // console.log(clockShape.outputs[0].label);
                    // Redibuja el lienzo para reflejar el cambio de color
                    evaluateShapes();
                    redraw();
                }, 1000); // 1000 milisegundos = 1 segundo
                clockShape.isRunning = true;
            }
            redraw();

        }

        // Agregar un evento de clic al botón de guardar
        const saveButton = document.getElementById('saveButton');
        saveButton.addEventListener('click', saveToFile);

        // Función para guardar el contenido en un archivo JSON
        function saveToFile() {
            // Obtener el nombre del archivo del campo de entrada de texto
            var fileName = document.getElementById('fileName').value;

            if (!fileName) {
                alert('Por favor, ingrese un nombre de archivo.');
                return;
            }

            // Crear un objeto que contiene el nombre del archivo y los datos a guardar
            var saveData = {
                fileName: fileName,
                shapes: shapes,
                connectors: connectors
            };

            // Convertir el objeto en una cadena JSON
            var jsonData = JSON.stringify(saveData);

            // Crear un enlace invisible para descargar el archivo JSON
            var a = document.createElement('a');
            var file = new Blob([jsonData], { type: 'application/json' });
            a.href = URL.createObjectURL(file);
            a.download = fileName + '.json';
            a.style.display = 'none';
            document.body.appendChild(a);

            // Simular un clic en el enlace para iniciar la descarga
            a.click();

            // Limpiar el enlace y el campo de entrada de texto
            document.body.removeChild(a);
            document.getElementById('fileName').value = '';
        }


        // Agregar un evento de clic al botón de cargar
        const loadButton = document.getElementById('loadButton');
        loadButton.addEventListener('click', loadFromFile);

        function loadFromFile() {
    // Obtener el control de entrada de archivo
    const input = document.getElementById('loadFile');

    // Agregar un evento de cambio para manejar la carga del archivo
    input.addEventListener('change', function (event) {
        const file = event.target.files[0];

        if (file) {
            const reader = new FileReader();

            reader.onload = function (e) {
                const contents = e.target.result;

                try {
                    // Parsear el contenido JSON
                    const data = JSON.parse(contents);

                    // Restaurar las formas y los conectores
                    shapes = data.shapes;
                    connectors = data.connectors;

                    // Ajustar las coordenadas de inicio y fin de las conexiones
                    updateConnectorCoordinates();

                    // Llamar a la función para dibujar
                    redraw();
                } catch (error) {
                    console.error('Error al cargar el archivo:', error);
                }
            };

            reader.readAsText(file);
        }
    });

    // Simular un clic en el control de entrada de archivo
    input.click();
}


function loadFromURL(url) {
    // Utiliza la función fetch para cargar el archivo JSON
    fetch(url)
    .then(response => {
        if (!response.ok) {
        throw new Error(`No se pudo cargar el archivo JSON. Status: ${response.status}`);
        }
        return response.json(); // Convierte la respuesta a JSON
    })
    .then(data => {
        // El objeto 'data' ahora contiene el contenido del archivo JSON
        // Puedes acceder a las formas (shapes) y conectores (connectors) aquí
        const loadedShapes = data.shapes;
        const loadedConnectors = data.connectors;

        // Haz lo que necesites con los datos cargados
        // Por ejemplo, puedes actualizar tu lista de 'shapes' y 'connectors' con estos datos
        shapes = loadedShapes;
        connectors = loadedConnectors;

        // Ajustar las coordenadas de inicio y fin de las conexiones
        updateConnectorCoordinates();

        // Llamar a la función para dibujar
        redraw();
    })
    .catch(error => {
        console.error('Error al cargar el archivo JSON:', error);
    });
}

    // URL del archivo JSON

    const loadSample1 = document.getElementById('loadSample1');
    loadSample1.addEventListener('click', function () {
        loadFromURL('https://raw.githubusercontent.com/ravendano014/logicgateslab/main/samples/BCD_to_7_Segment_Gates.json');
    });

    const loadSample2 = document.getElementById('loadSample2');loadSample2
    loadSample2.addEventListener('click', function () {
        loadFromURL('https://raw.githubusercontent.com/ravendano014/logicgateslab/main/samples/JK_Flip_Flop.json');
    });

    const loadSample3 = document.getElementById('loadSample3');loadSample3
    loadSample3.addEventListener('click', function () {
        loadFromURL('https://raw.githubusercontent.com/ravendano014/logicgateslab/main/samples/D_Latch.json');
    });

    const loadSample4 = document.getElementById('loadSample4');loadSample4
    loadSample4.addEventListener('click', function () {
        loadFromURL('https://raw.githubusercontent.com/ravendano014/logicgateslab/main/samples/One_Bit_Memory.json');
    });

        // Función para actualizar las coordenadas de inicio y fin de las conexiones
        function updateConnectorCoordinates() {
            var booleanExp = '';
            for (const connector of connectors) {
                const startShape = shapes.find(shape => shape.name === connector.startShape.name);
                const endShape = shapes.find(shape => shape.name === connector.endShape.name);
                booleanExp = booleanExp + getBooleanExpression(connector);
                if (startShape && endShape) {
                    connector.startShape = startShape;
                    connector.endShape = endShape;
                    connector.startOutput = startShape.outputs.find(output => output.label === connector.startOutput.label);
                    connector.endInput = endShape.inputs.find(input => input.label === connector.endInput.label);
                }
            }
            // console.log(booleanExp);
        }

    function getBooleanExpression(connector) {
        const startShapeType = connector.startShape.type;
        const endShapeType = connector.endShape.type;
        const startOutputLabel = connector.startOutput.label;
        const endInputLabel = connector.endInput.label;

        // Define las variables booleanas correspondientes a las salidas de las formas de inicio y fin
        const startOutputVariable = `${startShapeType}_${startOutputLabel}`;
        const endInputVariable = `${endShapeType}_${endInputLabel}`;

        // Genera la expresión booleana en función de la lógica de las formas conectadas
        let booleanExpression = '';

        if (startShapeType === 'InputL') {
            // Si la forma de inicio es un InputL, la variable booleana de inicio es directamente su color
              booleanExpression = `${startOutputVariable}`;
        } else {
            // Si la forma de inicio es una compuerta lógica, usa la lógica correspondiente
            switch (startShapeType) {
                case 'AND':
                    booleanExpression = `(${startOutputVariable} AND ${endInputVariable})`;
                    break;
                case 'OR':
                    booleanExpression = `(${startOutputVariable} OR ${endInputVariable})`;
                    break;
                case 'NOT':
                    booleanExpression = `(NOT ${startOutputVariable})`;
                    break;
                // Agrega casos para otras compuertas lógicas si es necesario
            }
        }

        return booleanExpression;
    }

    function getBooleanExpressionForShape(shape) {
    const shapeType = shape.type;

    // Verifica el tipo de forma y genera la expresión booleana correspondiente
    switch (shapeType) {
        case 'AND':
            return generateANDBooleanExpression(shape);
        case 'OR':
            return generateORBooleanExpression(shape);
        case 'NOT':
            return generateNOTBooleanExpression(shape);
        case 'NAND':
            return generateNANDBooleanExpression(shape);
        case 'NOR':
            return generateNORBooleanExpression(shape);
        case 'XOR':
            return generateXORBooleanExpression(shape);
        case 'XNOR':
            return generateXNORBooleanExpression(shape);
        // Agrega casos para otros tipos de formas si es necesario
        default:
            return '';
    }
}

// Funciones para generar expresiones booleanas para diferentes tipos de formas lógicas

function generateANDBooleanExpression(shape) {
    const inputs = shape.inputs.map(input => input.label.split('')[input.label.length - 1]  ).join('*');
    const output = shape.outputs[0].label;
    return `(${inputs})`;
}

function generateORBooleanExpression(shape) {
    const inputs = shape.inputs.map(input => input.label.split('')[input.label.length - 1]  ).join('+');
    const output = shape.outputs[0].label;
    return `(${inputs})`;
}

function generateNOTBooleanExpression(shape) {
    const input = shape.inputs[0].label.split('')[shape.inputs[0].label.length - 1];
    const output = shape.outputs[0].label;
    return `(${input}')`;
}

function generateNANDBooleanExpression(shape) {
    const inputs = shape.inputs.map(input => input.label.split('')[input.label.length - 1]  ).join('*');
    const output = shape.outputs[0].label;
    return `(${inputs})'`;
}

function generateNORBooleanExpression(shape) {
    const inputs = shape.inputs.map(input => input.label.split('')[input.label.length - 1]  ).join('+');
    const output = shape.outputs[0].label;
    return `(${inputs})'`;
}

function generateXORBooleanExpression(shape) {
    const inputs = shape.inputs.map(input => input.label.split('')[input.label.length - 1]  ).join('*');
    const inputs2 = shape.inputs.map(input => input.label.split('')[input.label.length - 1]  ).join("'*");
    const output = shape.outputs[0].label;
    return `(${inputs}'+${inputs2})`;
}

function generateXNORBooleanExpression(shape) {
    const inputs = shape.inputs.map(input => input.label.split('')[input.label.length - 1]  ).join('*');
    const inputs2 = shape.inputs.map(input => input.label.split('')[input.label.length - 1]  ).join("'*");
    const output = shape.outputs[0].label;
    return `(${inputs}'+${inputs2})'`;
}

function deleteSelectedShape() {
    if (confirm('Delete '+selectedShape.type+' Component') == true) {
        if (selectedShape) {
            // Encuentra la shape seleccionada en el arreglo de shapes y elimínala
            const index = shapes.indexOf(selectedShape);
            if (index !== -1) {
                shapes.splice(index, 1);
                selectedShape = null; // Deselecciona la shape
                redraw();
            }
        }
    }
   
}    

function deleteSelectedConnector() {
    if (confirm('Delete '+selectedConnector.startShape.type+' to '+selectedConnector.endShape.type+' Connector') == true) {
        if (selectedConnector) {
            // Encuentra la conexión seleccionada en el arreglo de conexiones y elimínala
            const index = connectors.indexOf(selectedConnector);
            if (index !== -1) {
                connectors.splice(index, 1);
                selectedConnector = null; // Deselecciona la conexión
                redraw();
            }
        }
    }
}

document.addEventListener('keydown', (event) => {

    if (event.key === 'Delete' && selectedConnector) {
        // Si se presiona la tecla "Delete" y hay una conexión seleccionada, elimínala
        deleteSelectedConnector();
    }
    if (event.key === 'Delete' && selectedShape) {
        deleteSelectedShape();
    }
});

canvas.addEventListener('click', (event) => {
    const mouseX = event.offsetX;
    const mouseY = event.offsetY;

    // Verifica si se hizo clic en una conexión
    for (const connector of connectors) {
        const startX = connector.startShape.x + connector.startOutput.x;
        const startY = connector.startShape.y + connector.startOutput.y;
        const endX = connector.endShape.x + connector.endInput.x;
        const endY = connector.endShape.y + connector.endInput.y;

       

        // Calcula si el clic está cerca de la conexión
        const distance = Math.sqrt((mouseX - startX) ** 2 + (mouseY - startY) ** 2);
        if (distance < 60) {
            // Cambia el estado isSelected del conector
            connector.isSelected = !connector.isSelected;
            selectedConnector = connector;
            connector.isSelected = true;
            // Redibuja el lienzo para reflejar el cambio de estado
            redraw();
            return;
        }

        const distance2 = Math.sqrt((mouseX - endX) ** 2 + (mouseY - endY) ** 2);
        if (distance2 < 6) {
            // Cambia el estado isSelected del conector
            connector.isSelected = !connector.isSelected;
            selectedConnector = connector;
            connector.isSelected = true;
            // Redibuja el lienzo para reflejar el cambio de estado
            redraw();
            return;
        }
    }

    // Si no se hizo clic en ninguna conexión, deselecciona todas las conexiones
    selectedConnector = null;
    for (const connector of connectors) {
        connector.isSelected = false;
        drawConnector(connector);
    }


    if (isEditingLabel) {
        isEditingLabel = false;
        editedShape = null;
    }

});


// Tabla de verdad BCD a 7 segmentos
function bcdToSegments(bcd) {
    switch (bcd) {
        case "0000":
            return [1, 1, 1, 1, 1, 1, 0]; // 0
        case "0001":
            return [0, 1, 1, 0, 0, 0, 0]; // 1
        case "0010":
            return [1, 1, 0, 1, 1, 0, 1]; // 2
        case "0011":
            return [1, 1, 1, 1, 0, 0, 1]; // 3
        case "0100":
            return [0, 1, 1, 0, 0, 1, 1]; // 4
        case "0101":
            return [1, 0, 1, 1, 0, 1, 1]; // 5
        case "0110":
            return [1, 0, 1, 1, 1, 1, 1]; // 6
        case "0111":
            return [1, 1, 1, 0, 0, 0, 0]; // 7
        case "1000":
            return [1, 1, 1, 1, 1, 1, 1]; // 8
        case "1001":
            return [1, 1, 1, 1, 0, 1, 1]; // 9
        default:
            return [0, 0, 0, 0, 0, 0, 0]; // Invalid
    }
}



// Función para mostrar la salida en los segmentos
function showOutput(bcd,bcdInput) {
    console.log(bcd);
    var segments = bcdToSegments(bcdInput);

    bcd.outputs.forEach(function (index) {
        console.log(bcd.outputs[segments[index]].label);
        if (segments[index]) {
           bcd.outputs[segments[index]].label = `Q : ${clockShape.color === "blue" ? '0' : '1'}`;
        }
    });
}

function createNewCircuit() {
    // Elimina todas las formas y conectores existentes
    shapes = [];
    connectors = [];

    // Redibujar para limpiar el lienzo
    redraw();
}

function generateTruthTable() {
    // Verificar si hay al menos una entrada y una salida
    const inputShapes = shapes.filter(shape => shape.type === "InputL");
    const outputShapes = shapes.filter(shape => shape.type === "OutPutL");
   
    if (inputShapes.length === 0 || outputShapes.length === 0) {
        alert("Debe haber al menos una entrada y una salida en el circuito para generar la tabla de verdad.");
        return;
    }

    // Crear un objeto que representará la tabla de verdad
    const truthTable = [];

    // Obtener las etiquetas de las entradas
    const inputLabels = inputShapes.map(shape => shape.label);

    // Obtener las etiquetas de las salidas
    const outputLabels = outputShapes.map(shape => shape.label);

    // Calcular la cantidad total de combinaciones posibles
    const totalCombinations = 2 ** inputLabels.length;

    // Generar todas las combinaciones posibles de entradas y evaluar el circuito
    for (let i = 0; i < totalCombinations; i++) {
        const binaryInputs = getBinaryString(i, inputLabels.length);
        const inputValues = binaryInputs.split('').map(Number);

        // Configurar los valores de las entradas
        inputShapes.forEach((shape, index) => {
            shape.color = inputValues[index] === 0 ? "red" : "green";
            shape.outputs[0].label = `Output A: ${inputValues[index]}`;
        });

        // Evaluar el circuito y obtener los valores de las salidas
        const outputValues = outputShapes.map(shape => {
            evaluateOutput(shape);
            return shape.color === "green" ? 1 : 0;
        });

        // Agregar esta combinación a la tabla de verdad
        truthTable.push([...inputValues, ...outputValues]);
    }

    // Imprimir la tabla de verdad en la consola
    console.log("Tabla de Verdad:");
    console.log("Entradas:", inputLabels.join(", "));
    console.log("Salidas:", outputLabels.join(", "));
    console.table(truthTable);

    return truthTable;
}

function getBinaryString(number, length) {
    // Convierte un número decimal a una cadena binaria con relleno de ceros
    let binaryString = number.toString(2);
    while (binaryString.length < length) {
        binaryString = "0" + binaryString;
    }
    return binaryString;
}

function createShapesFromTruthTable(gateType) {
    //  const shapes = [];
    truthTable = generateTruthTable();
    // console.log(truthTable);

    // Asume que gateType es uno de los tipos de puertas lógicas que defines (AND, OR, etc.)
    // Asegúrate de tener las definiciones adecuadas de las shapes en tu código.

    for (const row of truthTable) {
        const newShape = {
            type: gateType,
            x: 0, // Establece las coordenadas iniciales
            y: 0,
            width: 100, // Establece el tamaño predeterminado
            height: 50,
            label: gateType,
            inputs: [],
            outputs: [],
            name: randomName(),
            isRunning: false, // Indicador para controlar si el reloj está en funcionamiento
            intervalId: null, // Identificador del intervalo para el pulso
        };

        // Agrega entradas según la tabla de verdad
        for (const key in row) {
            if (key.startsWith('input')) {
                newShape.inputs.push({ x: 0, y: 0, label: `${key}: ${row[key]}` });
            }
        }

        // Agrega una salida según la tabla de verdad
        newShape.outputs.push({ x: 0, y: 0, label: `Output: ${row.output}` });

        shapes.push(newShape);
        console.log(newShape);
    }

    return shapes;
}

function buildComponent(){

    const newShapes = createShapesFromTruthTable("Component");

    // Agrega las nuevas shapes al arreglo de shapes existente
    shapes = shapes.concat(newShapes);

    // Redibuja el contenido del canvas
    redraw();
}


    </script>
</body>
</html>
